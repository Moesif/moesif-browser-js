(function() {
(function(){var I,J,K,L,M;function T(a,b,d){o.log("processResponse for"+a._url);var f=(new Date).toISOString();if(d){var h=a._url?a._url.toLowerCase():a._url;if(h&&0>h.indexOf("moesif.com")&&0>h.indexOf("apirequest.io")){a:if((h=a._url)&&"string"===typeof h){var e=c.trim(h);if(0!==e.indexOf("http")){h=ia+window.location.host+"/"+e.replace(/^\./,"").replace(/^\//,"");break a}}h={uri:h,verb:a._method,time:a._startTime,headers:a._requestHeaders};if(b)if("string"===typeof b)o.log("request post data is string"),
o.log(b),b=N(b),h.transfer_encoding=b.transfer_encoding,h.body=b.body;else if("object"===typeof b||Array.isArray(b)||"number"===typeof b||"boolean"===typeof b)h.body=b;e=a.getAllResponseHeaders();o.log("rawResponseHeaders are "+e);b={};if(e)for(var e=e.split("\r\n"),g=0;g<e.length;g++){var j=e[g],i=j.indexOf(": ");if(0<i){var m=j.substring(0,i);b[m]=j.substring(i+2)}}e=a.status;1223===e&&(e=204);f={status:e,time:f,headers:b};o.log("responseType: "+a.responseType);o.log("responseText: "+a.responseText);
o.log("response: "+a.response);b=a.responseText;e={};if(b)e=N(b),f.body=e.body,f.transfer_encoding=e.transfer_encoding;else if(a.response)if(o.log("no responseText trying with xhr.response"),c.isString(a.response))o.log("response is string. attempt to parse"),e=N(a.response),f.body=e.body,f.transfer_encoding=e.transfer_encoding;else if(c.isArrayBuffer(a.response))o.log("response is arraybuffer. attempt to parse"),e=U(a.response),f.body=e.body,f.transfer_encoding=e.transfer_encoding;else if(c.isArray(a.response)||
c.isObject(a.response))f.body=a.response;d({request:h,response:f})}}}function ja(a,b){var d=XMLHttpRequest.prototype,f=b&&b.eagerBodyLogging,h=d.open,e=d.send,g=d.setRequestHeader;d.open=function(a,b){o.log("XHR open triggered");this._method=a;this._url=b;this._requestHeaders={};this._startTime=(new Date).toISOString();return h.apply(this,arguments)};d.setRequestHeader=function(a,b){this._requestHeaders[a]=b;return g.apply(this,arguments)};d.send=function(b){o.log("XHR send started for "+this._url);
var d=this;if(f||!this.addEventListener){var h=this.onreadystatechange;this.onreadystatechange=function(){var f=d.readyState;o.log("readyState "+f);f===XMLHttpRequest.DONE&&(o.log("XHR onreadystatechange DONE triggered for "+d._url),T(d,b,a));if(h&&c.isFunction(h))return o.log("trigger old onreadystatechange"),h.apply(this,arguments)}}else this.addEventListener("loadend",function(){o.log("XHR loadend triggered for "+d._url);T(d,b,a)});return e.apply(this,arguments)};return function(){d.open=h;d.send=
e;d.setRequestHeader=g}}function V(a,b,d,f,h,e){b={uri:a&&a.host?a.host:"/",verb:"POST",time:b,headers:{}};if(a.headers){var g={};c.each(a.headers,function(a){g[a.name]=a.value});b.headers=g}if(f)if("string"===typeof f){s.log("request post data is string");s.log(f);try{b.body=c.JSONDecode(f)}catch(j){s.log("JSON decode failed"),s.log(j),b.transfer_encoding="base64",b.body=c.base64Encode(f)}}else if("object"===typeof f||Array.isArray(f)||"number"===typeof f||"boolean"===typeof postData)b.body=f;d=
{status:200,time:d,headers:{}};h?d.body=h:e&&(d.body={error:e});h={request:b,response:d,metadata:{_web3:{via_web3_provider:!0,path:a.path,host:a.host}}};a.isMetaMask&&(h.metadata._web3.is_metamask=!0);return h}function W(a,b){if(a.currentProvider){s.log("found my currentProvider, patching it");var d=a.currentProvider,c=d.send,h=d.sendAsync;d.send=function(a){s.log("patched send is called");s.log(a);var h=(new Date).toISOString(),j=c.apply(d,arguments);s.log("patch send result is back");s.log(j);var i=
(new Date).toISOString();b&&b(V(d,h,i,a,j));return j};d.sendAsync=function(a,c){s.log("patched sendAsync is called");s.log(a);var f=(new Date).toISOString();h.apply(d,[a,function(h,m){var l=(new Date).toISOString();s.log("inside patched callback");s.log(m);b&&b(V(d,f,l,a,m,h));c&&c(h,m)}])};return function(){d.send=c;d.sendAsync=h}}return null}function X(a){var b={};q.log("parseheaders is called");for(var a=a.entries(),d=a.next();!d.done;)q.log(d.value),b[d.value[0]]=d.value[1],d=a.next();return b}
function ka(a,b,d,c,h){try{setTimeout(function(){q.log("interception is here.");q.log(a);q.log(b);if(a&&b)try{Promise.all([a.arrayBuffer(),b.arrayBuffer()]).then(function(e){var g=e.map(U),e=Object.assign(g[0],{uri:a.url,verb:a.method,time:d,headers:X(a.headers)}),g=Object.assign(g[1],{status:b.status,time:c,headers:X(b.headers)});q.log(e);q.log(g);h({request:e,response:g})})}catch(e){q.error("error processing body")}else q.log("savedRequest")},50)}catch(e){q.error("error processing saved fetch request and response, but move on anyways."),
q.log(e)}}function la(a,b,d,c){var h=null;try{h=new Request(d,c)}catch(e){}var g=(new Date).toISOString(),j=null,i=null,i=b(d,c),m=null;return i=i.then(function(b){m=b.clone();j=(new Date).toISOString();ka(h,m,g,j,a);return b})}function ma(a,b){var d=b||window||self;if(d.fetch){q.log("found fetch method.");if(d.fetch.polyfill)return q.log("skip patching fetch since it is polyfilled"),null;var c=d.fetch;q.log("fetch is not polyfilled so instrumenting it");d.fetch=function(b){return function(d,c){return la(a,
b,d,c)}}(d.fetch);return function(){d.fetch=c}}q.log("there is no fetch found, so skipping instrumentation.")}function na(a,b){var d=a?"?"+a.split(".").slice(-1)[0].replace(/\|/g,"&"):"";Y.log("cookie");Y.log(d);var f=c.getQueryParamByName(I,b)||c.getQueryParamByName("utmcsr",d),h=c.getQueryParamByName(J,b)||c.getQueryParamByName("utmcmd",d),e=c.getQueryParamByName(K,b)||c.getQueryParamByName("utmccn",d),g=c.getQueryParamByName(L,b)||c.getQueryParamByName("utmctr",d),d=c.getQueryParamByName(M,b)||
c.getQueryParamByName("utmcct",d),j={},i=function(a,b){c.isEmptyString(b)||(j[a]=b)};i(I,f);i(J,h);i(K,e);i(L,g);i(M,d);return j}function oa(a){try{var b={};if(!a.disableUtm)var d=void 0,f=void 0,d=location&&location.search,f=c.cookie.get("__utmz"),b=na(f,d)||{};if(!a.disableReferer){var h;var e=document&&document.referrer,g;if(c.isEmptyString(e))g=void 0;else{var j;if(c.isEmptyString(e))j=null;else{var i=e.split("/");j=3<=i.length?i[2]:null}g={referrer:e,referring_domain:j}}h=g;if(h)b.referrer=h.referrer,
b.referring_domain=h.referring_domain}if(!a.disableRGclid){var m,l=c.getQueryParamByName("gclid",location&&location.search);(m=c.isEmptyString(l)?void 0:l)&&(b.gclid=m)}return b}catch(p){pa.log(p)}}function Z(a){try{return a.request.headers["X-Moesif-SDK"]}catch(b){return!1}}function qa(a){if(!a)throw Error("options are required by moesif-express middleware");if(!a.applicationId)throw Error("A moesif application id is required. Please obtain it through your settings at www.moesif.com");if(a.getTags&&
!c.isFunction(a.getTags))throw Error("getTags should be a function");if(a.getMetadata&&!c.isFunction(a.getMetadata))throw Error("getMetadata should be a function");if(a.getApiVersion&&!c.isFunction(a.getApiVersion))throw Error("identifyUser should be a function");if(a.maskContent&&!c.isFunction(a.maskContent))throw Error("maskContent should be a function");if(a.skip&&!c.isFunction(a.skip))throw Error("skip should be a function");}var r;r="undefined"===typeof window?{navigator:{}}:window;var F=Array.prototype,
$=Object.prototype,z=F.slice,C=$.toString,G=$.hasOwnProperty,D=r.console,A=r.navigator,u=r.document,n=A.userAgent,O=Function.prototype.bind,aa=F.forEach,ba=F.indexOf,ca=F.map;r=Array.isArray;var P={},c={trim:function(a){return a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},k={log:function(){},error:function(){},critical:function(){if(!c.isUndefined(D)&&D){var a=["Moesif error:"].concat(c.toArray(arguments));try{D.error.apply(D,a)}catch(b){c.each(a,function(a){D.error(a)})}}}};c.bind=function(a,
b){var d,f;if(O&&a.bind===O)return O.apply(a,z.call(arguments,1));if(!c.isFunction(a))throw new TypeError;d=z.call(arguments,2);return f=function(){if(!(this instanceof f))return a.apply(b,d.concat(z.call(arguments)));var c={};c.prototype=a.prototype;var e=new c;c.prototype=null;c=a.apply(e,d.concat(z.call(arguments)));return Object(c)===c?c:e}};c.bind_instance_methods=function(a){for(var b in a)"function"===typeof a[b]&&(a[b]=c.bind(a[b],a))};c.isEmptyString=function(a){return!a||0===a.length};c.each=
function(a,b,d){if(!(null===a||void 0===a))if(aa&&a.forEach===aa)a.forEach(b,d);else if(a.length===+a.length)for(var c=0,h=a.length;c<h&&!(c in a&&b.call(d,a[c],c,a)===P);c++);else for(c in a)if(G.call(a,c)&&b.call(d,a[c],c,a)===P)break};c.escapeHTML=function(a){a&&c.isString(a)&&(a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"));return a};c.extend=function(a){c.each(z.call(arguments,1),function(b){for(var d in b)void 0!==b[d]&&(a[d]=
b[d])});return a};c.isArray=r||function(a){return"[object Array]"===C.call(a)};c.isFunction=function(a){try{return/^\s*\bfunction\b/.test(a)}catch(b){return!1}};c.isArguments=function(a){return!(!a||!G.call(a,"callee"))};c.toArray=function(a){return!a?[]:a.toArray?a.toArray():c.isArray(a)||c.isArguments(a)?z.call(a):c.values(a)};c.map=function(a,b){if(ca&&a.map===ca)return a.map(b);var d=[];c.each(a,function(a){d.push(b(a))});return d};c.values=function(a){var b=[];if(null===a)return b;c.each(a,function(a){b[b.length]=
a});return b};c.identity=function(a){return a};c.include=function(a,b){var d=!1;if(null===a)return d;if(ba&&a.indexOf===ba)return-1!=a.indexOf(b);c.each(a,function(a){if(d||(d=a===b))return P});return d};c.includes=function(a,b){return-1!==a.indexOf(b)};c.inherit=function(a,b){a.prototype=new b;a.prototype.constructor=a;a.superclass=b.prototype;return a};c.isArrayBuffer=function(a){var b=Object.prototype.toString;return"function"===typeof ArrayBuffer&&(a instanceof ArrayBuffer||"[object ArrayBuffer]"===
b.call(a))};c.isObject=function(a){return a===Object(a)&&!c.isArray(a)};c.isEmptyObject=function(a){if(c.isObject(a)){for(var b in a)if(G.call(a,b))return!1;return!0}return!1};c.isUndefined=function(a){return void 0===a};c.isString=function(a){return"[object String]"==C.call(a)};c.isDate=function(a){return"[object Date]"==C.call(a)};c.isNumber=function(a){return"[object Number]"==C.call(a)};c.isElement=function(a){return!!(a&&1===a.nodeType)};c.encodeDates=function(a){c.each(a,function(b,d){c.isDate(b)?
a[d]=c.formatDate(b):c.isObject(b)&&(a[d]=c.encodeDates(b))});return a};c.timestamp=function(){Date.now=Date.now||function(){return+new Date};return Date.now()};c.formatDate=function(a){function b(a){return 10>a?"0"+a:a}return a.getUTCFullYear()+"-"+b(a.getUTCMonth()+1)+"-"+b(a.getUTCDate())+"T"+b(a.getUTCHours())+":"+b(a.getUTCMinutes())+":"+b(a.getUTCSeconds())};c.safewrap=function(a){return function(){try{return a.apply(this,arguments)}catch(b){k.critical("Implementation error. Please contact support@moesif.com.")}}};
c.safewrap_class=function(a,b){for(var d=0;d<b.length;d++)a.prototype[b[d]]=c.safewrap(a.prototype[b[d]])};c.safewrap_instance_methods=function(a){for(var b in a)"function"===typeof a[b]&&(a[b]=c.safewrap(a[b]))};c.strip_empty_properties=function(a){var b={};c.each(a,function(a,f){c.isString(a)&&0<a.length&&(b[f]=a)});return b};c.truncate=function(a,b){var d;"string"===typeof a?d=a.slice(0,b):c.isArray(a)?(d=[],c.each(a,function(a){d.push(c.truncate(a,b))})):c.isObject(a)?(d={},c.each(a,function(a,
h){d[h]=c.truncate(a,b)})):d=a;return d};c.JSONEncode=function(){return function(a){var b=function(a){var b=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,d={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};b.lastIndex=0;return b.test(a)?'"'+a.replace(b,function(a){var b=d[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'},d=function(a,
c){var e="",g=0,j=g="",j=0,i=e,m=[],l=c[a];l&&"object"===typeof l&&"function"===typeof l.toJSON&&(l=l.toJSON(a));switch(typeof l){case "string":return b(l);case "number":return isFinite(l)?""+l:"null";case "boolean":case "null":return""+l;case "object":if(!l)return"null";e+="    ";m=[];if("[object Array]"===C.apply(l)){j=l.length;for(g=0;g<j;g+=1)m[g]=d(g,l)||"null";return j=0===m.length?"[]":e?"[\n"+e+m.join(",\n"+e)+"\n"+i+"]":"["+m.join(",")+"]"}for(g in l)G.call(l,g)&&(j=d(g,l))&&m.push(b(g)+
(e?": ":":")+j);return j=0===m.length?"{}":e?"{"+m.join(",")+""+i+"}":"{"+m.join(",")+"}"}};return d("",{"":a})}}();c.JSONDecode=function(){var a,b,d={'"':'"',"\\":"\\","/":"/",b:"\u0008",f:"\u000c",n:"\n",r:"\r",t:"\t"},c,h=function(b){throw{name:"SyntaxError",message:b,at:a,text:c};},e=function(d){d&&d!==b&&h("Expected '"+d+"' instead of '"+b+"'");b=c.charAt(a);a+=1;return b},g=function(){var a;a="";"-"===b&&(a="-",e("-"));for(;"0"<=b&&"9">=b;)a+=b,e();if("."===b)for(a+=".";e()&&"0"<=b&&"9">=b;)a+=
b;if("e"===b||"E"===b){a+=b;e();if("-"===b||"+"===b)a+=b,e();for(;"0"<=b&&"9">=b;)a+=b,e()}a=+a;if(isFinite(a))return a;h("Bad number")},j=function(){var a,c,f="",g;if('"'===b)for(;e();){if('"'===b)return e(),f;if("\\"===b)if(e(),"u"===b){for(c=g=0;4>c;c+=1){a=parseInt(e(),16);if(!isFinite(a))break;g=16*g+a}f+=String.fromCharCode(g)}else if("string"===typeof d[b])f+=d[b];else break;else f+=b}h("Bad string")},i=function(){for(;b&&" ">=b;)e()},m=function(){switch(b){case "t":return e("t"),e("r"),e("u"),
e("e"),!0;case "f":return e("f"),e("a"),e("l"),e("s"),e("e"),!1;case "n":return e("n"),e("u"),e("l"),e("l"),null}h('Unexpected "'+b+'"')},l;l=function(){i();switch(b){case "{":var a;a:{var d,c={};if("{"===b){e("{");i();if("}"===b){e("}");a=c;break a}for(;b;){d=j();i();e(":");Object.hasOwnProperty.call(c,d)&&h('Duplicate key "'+d+'"');c[d]=l();i();if("}"===b){e("}");a=c;break a}e(",");i()}}h("Bad object")}return a;case "[":a:{a=[];if("["===b){e("[");i();if("]"===b){e("]");d=a;break a}for(;b;){a.push(l());
i();if("]"===b){e("]");d=a;break a}e(",");i()}}h("Bad array")}return d;case '"':return j();case "-":return g();default:return"0"<=b&&"9">=b?g():m()}};return function(d){c=d;a=0;b=" ";d=l();i();b&&h("Syntax error");return d}}();c.base64Encode=function(a){var b,d,f,h,e=0,g=0,j="",j=[];if(!a)return a;a=c.utf8Encode(a);do b=a.charCodeAt(e++),d=a.charCodeAt(e++),f=a.charCodeAt(e++),h=b<<16|d<<8|f,b=h>>18&63,d=h>>12&63,f=h>>6&63,h&=63,j[g++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h);while(e<a.length);j=j.join("");switch(a.length%3){case 1:j=j.slice(0,-2)+"==";break;case 2:j=j.slice(0,-1)+"="}return j};c.utf8Encode=function(a){var a=(a+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n"),b="",d,c,h=0,e;d=c=0;h=a.length;for(e=0;e<h;e++){var g=a.charCodeAt(e),
j=null;128>g?c++:j=127<g&&2048>g?String.fromCharCode(g>>6|192,g&63|128):String.fromCharCode(g>>12|224,g>>6&63|128,g&63|128);null!==j&&(c>d&&(b+=a.substring(d,c)),b+=j,d=c=e+1)}c>d&&(b+=a.substring(d,a.length));return b};c.UUID=function(){var a=function(){for(var a=1*new Date,b=0;a==1*new Date;)b++;return a.toString(16)+b.toString(16)},b=function(){function a(b,c){var d,f=0;for(d=0;d<c.length;d++)f|=e[d]<<8*d;return b^f}var b,c,e=[],g=0;for(b=0;b<n.length;b++)c=n.charCodeAt(b),e.unshift(c&255),4<=
e.length&&(g=a(g,e),e=[]);0<e.length&&(g=a(g,e));return g.toString(16)};return function(){var c=(screen.height*screen.width).toString(16);return a()+"-"+Math.random().toString(16).replace(".","")+"-"+b()+"-"+c+"-"+a()}}();c.isBlockedUA=function(a){return/(google web preview|baiduspider|yandexbot|bingbot|googlebot|yahoo! slurp)/i.test(a)?!0:!1};c.HTTPBuildQuery=function(a,b){var d,f,h=[];c.isUndefined(b)&&(b="&");c.each(a,function(a,b){d=encodeURIComponent(a.toString());f=encodeURIComponent(b);h[h.length]=
f+"="+d});return h.join(b)};c.getQueryParamByName=function(a,b){var a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),c=RegExp("[\\?&]"+a+"=([^&#]*)").exec(b);return null===c?void 0:decodeURIComponent(c[1].replace(/\+/g," "))};c.getQueryParam=function(a,b){var b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),c=RegExp("[\\?&]"+b+"=([^&#]*)").exec(a);return null===c||c&&"string"!==typeof c[1]&&c[1].length?"":decodeURIComponent(c[1]).replace(/\+/g," ")};c.getHashParam=function(a,b){var c=a.match(RegExp(b+
"=([^&]*)"));return c?c[1]:null};c.cookie={get:function(a){for(var a=a+"=",b=u.cookie.split(";"),c=0;c<b.length;c++){for(var f=b[c];" "==f.charAt(0);)f=f.substring(1,f.length);if(0===f.indexOf(a))return decodeURIComponent(f.substring(a.length,f.length))}return null},parse:function(a){var b;try{b=c.JSONDecode(c.cookie.get(a))||{}}catch(d){}return b},set_seconds:function(a,b,c,f,h){var d;var e="",g="",j="";f&&(d=(e=(e=u.location.hostname.match(/[a-z0-9][a-z0-9\-]+\.[a-z\.]{2,6}$/i))?e[0]:"")?"; domain=."+
e:"",e=d);c&&(g=new Date,g.setTime(g.getTime()+1E3*c),g="; expires="+g.toGMTString());h&&(j="; secure");u.cookie=a+"="+encodeURIComponent(b)+g+"; path=/"+e+j},set:function(a,b,c,f,h){var d;var e="",g="",j="";f&&(d=(e=(e=u.location.hostname.match(/[a-z0-9][a-z0-9\-]+\.[a-z\.]{2,6}$/i))?e[0]:"")?"; domain=."+e:"",e=d);c&&(g=new Date,g.setTime(g.getTime()+864E5*c),g="; expires="+g.toGMTString());h&&(j="; secure");a=a+"="+encodeURIComponent(b)+g+"; path=/"+e+j;return u.cookie=a},remove:function(a,b){c.cookie.set(a,
"",-1,b)}};var Q=null,R=function(a,b){if(null!==Q&&!b)return Q;var c=!0;try{var a=a||window.localStorage,f="__mplss_"+da(8);a.setItem(f,"xyz");"xyz"!==a.getItem(f)&&(c=!1);a.removeItem(f)}catch(h){c=!1}return Q=c};c.localStorage={error:function(a){k.error("localStorage error: "+a)},get:function(a){try{return window.localStorage.getItem(a)}catch(b){c.localStorage.error(b)}return null},parse:function(a){try{return c.JSONDecode(c.localStorage.get(a))||{}}catch(b){}return null},set:function(a,b){try{window.localStorage.setItem(a,
b)}catch(d){c.localStorage.error(d)}},remove:function(a){try{window.localStorage.removeItem(a)}catch(b){c.localStorage.error(b)}}};c.dom_query=function(){function a(a,b){var c;return 0<=(" "+a.className+" ").replace(d," ").indexOf(" "+b+" ")}function b(b){if(!u.getElementsByTagName)return[];var b=b.split(" "),d,e,g,j,i,m,l,p=[u];for(j=0;j<b.length;j++)if(d=b[j].replace(/^\s+/,"").replace(/\s+$/,""),-1<d.indexOf("#")){e=d.split("#");d=e[0];p=u.getElementById(e[1]);if(!p||d&&p.nodeName.toLowerCase()!=
d)return[];p=[p]}else if(-1<d.indexOf(".")){e=d.split(".");d=e[0];var k=e[1];d||(d="*");e=[];for(i=g=0;i<p.length;i++){l="*"==d?p[i].all?p[i].all:p[i].getElementsByTagName("*"):p[i].getElementsByTagName(d);for(m=0;m<l.length;m++)e[g++]=l[m]}p=[];for(i=d=0;i<e.length;i++)e[i].className&&c.isString(e[i].className)&&a(e[i],k)&&(p[d++]=e[i])}else if(e=d.match(/^(\w*)\[(\w+)([=~\|\^\$\*]?)=?"?([^\]"]*)"?\]$/)){d=e[1];var n=e[2],k=e[3],o=e[4];d||(d="*");e=[];for(i=g=0;i<p.length;i++){l="*"==d?p[i].all?
p[i].all:p[i].getElementsByTagName("*"):p[i].getElementsByTagName(d);for(m=0;m<l.length;m++)e[g++]=l[m]}p=[];d=0;switch(k){case "=":k=function(a){return a.getAttribute(n)==o};break;case "~":k=function(a){return a.getAttribute(n).match(RegExp("\\b"+o+"\\b"))};break;case "|":k=function(a){return a.getAttribute(n).match(RegExp("^"+o+"-?"))};break;case "^":k=function(a){return 0===a.getAttribute(n).indexOf(o)};break;case "$":k=function(a){return a.getAttribute(n).lastIndexOf(o)==a.getAttribute(n).length-
o.length};break;case "*":k=function(a){return-1<a.getAttribute(n).indexOf(o)};break;default:k=function(a){return a.getAttribute(n)}}p=[];for(i=d=0;i<e.length;i++)k(e[i])&&(p[d++]=e[i])}else{e=[];for(i=g=0;i<p.length;i++){l=p[i].getElementsByTagName(d);for(m=0;m<l.length;m++)e[g++]=l[m]}p=e}return p}var d=/[\t\r\n]/g;return function(a){return c.isElement(a)?[a]:c.isObject(a)&&!c.isUndefined(a.length)?a:b.call(this,a)}}();c.info={campaignParams:function(){var a="utm_source utm_medium utm_campaign utm_content utm_term".split(" "),
b="",d={};c.each(a,function(a){b=c.getQueryParam(u.URL,a);b.length&&(d[a]=b)});return d},searchEngine:function(a){return 0===a.search("https?://(.*)google.([^/?]*)")?"google":0===a.search("https?://(.*)bing.com")?"bing":0===a.search("https?://(.*)yahoo.com")?"yahoo":0===a.search("https?://(.*)duckduckgo.com")?"duckduckgo":null},searchInfo:function(a){var b=c.info.searchEngine(a),d;d={};if(null!==b)d.$search_engine=b,a=c.getQueryParam(a,"yahoo"!=b?"q":"p"),a.length&&(d.mp_keyword=a);return d},browser:function(a,
b,d){b=b||"";return d||c.includes(a," OPR/")?c.includes(a,"Mini")?"Opera Mini":"Opera":/(BlackBerry|PlayBook|BB10)/i.test(a)?"BlackBerry":c.includes(a,"IEMobile")||c.includes(a,"WPDesktop")?"Internet Explorer Mobile":c.includes(a,"Edge")?"Microsoft Edge":c.includes(a,"FBIOS")?"Facebook Mobile":c.includes(a,"Chrome")?"Chrome":c.includes(a,"CriOS")?"Chrome iOS":c.includes(a,"UCWEB")||c.includes(a,"UCBrowser")?"UC Browser":c.includes(a,"FxiOS")?"Firefox iOS":c.includes(b,"Apple")?c.includes(a,"Mobile")?
"Mobile Safari":"Safari":c.includes(a,"Android")?"Android Mobile":c.includes(a,"Konqueror")?"Konqueror":c.includes(a,"Firefox")?"Firefox":c.includes(a,"MSIE")||c.includes(a,"Trident/")?"Internet Explorer":c.includes(a,"Gecko")?"Mozilla":""},browserVersion:function(a,b,d){b={"Internet Explorer Mobile":/rv:(\d+(\.\d+)?)/,"Microsoft Edge":/Edge\/(\d+(\.\d+)?)/,Chrome:/Chrome\/(\d+(\.\d+)?)/,"Chrome iOS":/CriOS\/(\d+(\.\d+)?)/,"UC Browser":/(UCBrowser|UCWEB)\/(\d+(\.\d+)?)/,Safari:/Version\/(\d+(\.\d+)?)/,
"Mobile Safari":/Version\/(\d+(\.\d+)?)/,Opera:/(Opera|OPR)\/(\d+(\.\d+)?)/,Firefox:/Firefox\/(\d+(\.\d+)?)/,"Firefox iOS":/FxiOS\/(\d+(\.\d+)?)/,Konqueror:/Konqueror:(\d+(\.\d+)?)/,BlackBerry:/BlackBerry (\d+(\.\d+)?)/,"Android Mobile":/android\s(\d+(\.\d+)?)/,"Internet Explorer":/(rv:|MSIE )(\d+(\.\d+)?)/,Mozilla:/rv:(\d+(\.\d+)?)/}[c.info.browser(a,b,d)];if(void 0===b)return null;a=a.match(b);return!a?null:parseFloat(a[a.length-2])},os:function(){return/Windows/i.test(n)?/Phone/.test(n)||/WPDesktop/.test(n)?
"Windows Phone":"Windows":/(iPhone|iPad|iPod)/.test(n)?"iOS":/Android/.test(n)?"Android":/(BlackBerry|PlayBook|BB10)/i.test(n)?"BlackBerry":/Mac/i.test(n)?"Mac OS X":/Linux/.test(n)?"Linux":""},device:function(a){return/Windows Phone/i.test(a)||/WPDesktop/.test(a)?"Windows Phone":/iPad/.test(a)?"iPad":/iPod/.test(a)?"iPod Touch":/iPhone/.test(a)?"iPhone":/(BlackBerry|PlayBook|BB10)/i.test(a)?"BlackBerry":/Android/.test(a)?"Android":""},referringDomain:function(a){a=a.split("/");return 3<=a.length?
a[2]:""},properties:function(){return c.extend(c.strip_empty_properties({$os:c.info.os(),$browser:c.info.browser(n,A.vendor,window.opera),$referrer:u.referrer,$referring_domain:c.info.referringDomain(u.referrer),$device:c.info.device(n)}),{$current_url:window.location.href,$browser_version:c.info.browserVersion(n,A.vendor,window.opera),$screen_height:screen.height,$screen_width:screen.width,mp_lib:"web",$lib_version:"1.6.2"})},people_properties:function(){return c.extend(c.strip_empty_properties({$os:c.info.os(),
$browser:c.info.browser(n,A.vendor,window.opera)}),{$browser_version:c.info.browserVersion(n,A.vendor,window.opera)})},pageviewInfo:function(a){return c.strip_empty_properties({mp_page:a,mp_referrer:u.referrer,mp_browser:c.info.browser(n,A.vendor,window.opera),mp_platform:c.info.os()})}};var da=function(a){var b=Math.random().toString(36).substring(2,10)+Math.random().toString(36).substring(2,10);return a?b.substring(0,a):b},S=function(a,b){return function(){arguments[0]="["+b+"] "+arguments[0];return a.apply(k,
arguments)}};r=function(a){return{log:S(k.log,a),error:S(k.error,a),critical:S(k.critical,a)}};var E=null,H=null;if("undefined"!==typeof JSON)E=JSON.stringify,H=JSON.parse;E=E||c.JSONEncode;H=H||c.JSONDecode;c.toArray=c.toArray;c.isObject=c.isObject;c.JSONEncode=c.JSONEncode;c.JSONDecode=c.JSONDecode;c.isBlockedUA=c.isBlockedUA;c.isEmptyObject=c.isEmptyObject;c.isEmptyString=c.isEmptyString;c.each=c.each;c.info=c.info;c.info.device=c.info.device;c.info.browser=c.info.browser;c.info.properties=c.info.properties;
var x=r("parsers"),N=function(a){try{return{body:c.JSONDecode(a)}}catch(b){return x.log("JSON decode failed"),x.log(b),{transfer_encoding:"base64",body:c.base64Encode(a)}}},U=function(a){if(!a)return{};x.log("about to decode buffer");x.log(a);x.log(a.byteLength);if(0>=a.byteLength)return{};try{var b=(new TextDecoder("utf-8")).decode(a);try{return{body:c.JSONDecode(b)}}catch(d){return x.error(d),{transfer_encoding:"base64",body:c.base64Encode(b)}}}catch(f){return x.error(f),x.log(a),{transfer_encoding:"base64",
body:"can not be decoded"}}},o=r("capture"),ia="http:"===(document&&document.location.protocol)?"http://":"https://",s=r("web3capture"),q=r("capture fetch"),Y=r("utm");I="utm_source";J="utm_medium";K="utm_campaign";L="utm_term";M="utm_content";var pa=r("campaign"),ra=r("lock"),ea=function(a,b){b=b||{};this.storageKey=a;this.storage=b.storage||window.localStorage;this.pollIntervalMS=b.pollIntervalMS||100;this.timeoutMS=b.timeoutMS||2E3};ea.prototype.withLock=function(a,b,c){!c&&"function"!==typeof b&&
(c=b,b=null);var f=c||(new Date).getTime()+"|"+Math.random(),h=(new Date).getTime(),e=this.storageKey,g=this.pollIntervalMS,j=this.timeoutMS,i=this.storage,m=e+":X",l=e+":Y",k=e+":Z",n=function(a){(new Date).getTime()-h>j?(ra.error("Timeout waiting for mutex on "+e+"; clearing lock. ["+f+"]"),i.removeItem(k),i.removeItem(l),q()):setTimeout(function(){try{a()}catch(c){b&&b(c)}},g*(Math.random()+0.1))},o=function(a,b){a()?b():n(function(){o(a,b)})},r=function(){var a=i.getItem(l);if(a&&a!==f)return!1;
i.setItem(l,f);if(i.getItem(l)===f)return!0;if(!R(i,!0))throw Error("localStorage support dropped while acquiring lock");return!1},q=function(){i.setItem(m,f);o(r,function(){i.getItem(m)===f?s():n(function(){i.getItem(l)!==f?q():o(function(){return!i.getItem(k)},s)})})},s=function(){i.setItem(k,"1");try{a()}finally{i.removeItem(k),i.getItem(l)===f&&i.removeItem(l),i.getItem(m)===f&&i.removeItem(m)}};try{if(R(i,!0))q();else throw Error("localStorage support check failed");}catch(t){b&&b(t)}};var t=
r("batch"),y=function(a,b){b=b||{};this.storageKey=a;this.storage=b.storage||window.localStorage;this.lock=new ea(a,{storage:this.storage});this.pid=b.pid||null;this.memQueue=[]};y.prototype.enqueue=function(a,b,d){var f={id:da(),flushAfter:(new Date).getTime()+2*b,payload:a};this.lock.withLock(c.bind(function(){var b;try{var c=this.readFromStorage();c.push(f);if(b=this.saveToStorage(c))t.log("succeeded saving to storage"),this.memQueue.push(f)}catch(g){t.error("Error enqueueing item",a),b=!1}d&&
d(b)},this),function(a){t.error("Error acquiring storage lock",a);d&&d(!1)},this.pid)};y.prototype.fillBatch=function(a){var b=this.memQueue.slice(0,a);if(b.length<a){var d=this.readFromStorage();t.log("current storedQueue size "+d.length);if(d.length){var f={};c.each(b,function(a){f[a.id]=!0});for(var h=0;h<d.length;h++){var e=d[h];if((new Date).getTime()>e.flushAfter&&!f[e.id]&&(b.push(e),b.length>=a))break}}}return b};var fa=function(a,b){var d=[];c.each(a,function(a){a.id&&!b[a.id]&&d.push(a)});
return d};y.prototype.removeItemsByID=function(a,b){var d={};c.each(a,function(a){d[a]=!0});this.memQueue=fa(this.memQueue,d);this.lock.withLock(c.bind(function(){var c;try{var h=this.readFromStorage(),h=fa(h,d);t.log("new storedQueue "+h&&h.length);c=this.saveToStorage(h)}catch(e){t.error("Error removing items",a),c=!1}b&&(t.log("triggering callback of removalItems"),b(c))},this),function(a){t.error("Error acquiring storage lock",a);b&&b(!1)},this.pid)};y.prototype.readFromStorage=function(){var a;
try{t.log("trying to get storage with storage key "+this.storageKey),(a=this.storage.getItem(this.storageKey))?(a=H(a),c.isArray(a)||(t.error("Invalid storage entry:",a),a=null)):t.log("storageEntry is empty")}catch(b){t.error("Error retrieving queue",b),a=null}return a||[]};y.prototype.saveToStorage=function(a){try{return this.storage.setItem(this.storageKey,E(a)),!0}catch(b){return t.error("Error saving queue",b),!1}};y.prototype.clear=function(){this.memQueue=[];this.storage.removeItem(this.storageKey)};
var w=r("batch"),v=function(a,b,c){this.queue=new y(a,{storage:c.storage});this.endpoint=b;this.libConfig=c.libConfig;this.sendRequest=c.sendRequestFunc;this.batchSize=this.libConfig.batch_size;this.flushInterval=this.libConfig.batch_flush_interval_ms;this.stopped=!1};v.prototype.enqueue=function(a,b){this.queue.enqueue(a,this.flushInterval,b)};v.prototype.start=function(){this.stopped=!1;this.flush()};v.prototype.stop=function(){this.stopped=!0;if(this.timeoutID)clearTimeout(this.timeoutID),this.timeoutID=
null};v.prototype.clear=function(){this.queue.clear()};v.prototype.resetBatchSize=function(){this.batchSize=this.libConfig.batch_size};v.prototype.resetFlush=function(){this.scheduleFlush(this.libConfig.batch_flush_interval_ms)};v.prototype.scheduleFlush=function(a){this.flushInterval=a;if(!this.stopped)this.timeoutID=setTimeout(c.bind(this.flush,this),this.flushInterval)};v.prototype.flush=function(a){try{if(this.requestInProgress)w.log("Flush: Request already in progress");else{var a=a||{},b=this.batchSize,
d=this.queue.fillBatch(b);w.log("current batch size is "+d.length);if(1>d.length)this.resetFlush();else{this.requestInProgress=!0;var f=this.libConfig.batch_request_timeout_ms,h=(new Date).getTime(),e=c.map(d,function(a){return a.payload}),g=c.bind(function(a){this.requestInProgress=!1;try{var e=!1;if(c.isObject(a)&&"timeout"===a.error&&(new Date).getTime()-h>=f)w.error("Network timeout; retrying"),this.flush();else if(c.isObject(a)&&a.xhr_req&&(500<=a.xhr_req.status||0>=a.xhr_req.status)){var g=
2*this.flushInterval,i=a.xhr_req.responseHeaders;if(i){var j=i["Retry-After"];j&&(g=1E3*parseInt(j,10)||g)}g=Math.min(6E5,g);w.error("Error; retry in "+g+" ms");this.scheduleFlush(g)}else if(c.isObject(a)&&a.xhr_req&&413===a.xhr_req.status)if(1<d.length){var k=Math.max(1,Math.floor(b/2));this.batchSize=Math.min(this.batchSize,k,d.length-1);w.error("413 response; reducing batch size to "+this.batchSize);this.resetFlush()}else w.error("Single-event request too large; dropping",d),this.resetBatchSize(),
e=!0;else e=!0;e&&this.queue.removeItemsByID(c.map(d,function(a){return a.id}),c.bind(this.flush,this))}catch(n){w.error("Error handling API response",n),this.resetFlush()}},this),j={method:"POST",verbose:!0,ignore_json_errors:!0,timeout_ms:f};if(a.sendBeacon)j.transport="sendBeacon";w.log("Moesif Request:",this.endpoint,e);this.sendRequest(this.endpoint,e,j,g)}}}catch(i){w.error("Error flushing request queue",i),this.resetFlush()}};var ga=window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest;
!ga&&-1===n.indexOf("MSIE")&&n.indexOf("Mozilla");var ha=null;navigator.sendBeacon&&(ha=function(){return navigator.sendBeacon.apply(navigator,arguments)});var B="http:"===(document&&document.location.protocol)?"http://":"https://";window.moesif=function(){k.log("moesif object creator is called");return{init:function(a){window||k.critical("Warning, this library need to be initiated on the client side");qa(a);var b={};b.getTags=a.getTags||function(){};b.maskContent=a.maskContent||function(a){return a};
b.getMetadata=a.getMetadata||function(){};b.skip=a.skip||function(){return!1};b.debug=a.debug;b.callback=a.callback;b.applicationId=a.applicationId;b.apiVersion=a.apiVersion;b.disableFetch=a.disableFetch;b.disableReferrer=a.disableReferrer;b.disableGclid=a.disableGclid;b.disableUtm=a.disableUtm;b.eagerBodyLogging=a.eagerBodyLogging;b.batchEnabled=a.batchEnabled||!1;b.batch_size=a.batchSize||25;b.batch_flush_interval_ms=a.batchMaxTime||2500;b.batch_request_timeout_ms=a.batchTimeout||9E4;this.requestBatchers=
{};this._options=b;try{this._userId=localStorage.getItem("moesif_stored_user_id"),this._session=localStorage.getItem("moesif_stored_session_id"),this._companyId=localStorage.getItem("moesif_stored_company_id"),this._campaign=oa(b)}catch(d){k.error("error loading saved data from local storage but continue")}if(b.batchEnabled)!R||!ga?(b.batchEnabled=!1,k.log("Turning off batch processing because it needs XHR and localStorage")):(this.initBatching(),ha&&window.addEventListener&&window.addEventListener("unload",
c.bind(function(){this.requestBatchers.events.flush({sendBeacon:!0})},this)));k.log("moesif initiated");return this},_executeRequest:function(a,b,c,f){var h=c&&c.applicationId||this._options.applicationId,e=c&&c.method||"POST";try{var g=new XMLHttpRequest;g.open(e,a);g.setRequestHeader("Content-Type","application/json");g.setRequestHeader("X-Moesif-Application-Id",h);g.setRequestHeader("X-Moesif-SDK","moesif-browser-js/1.6.2");if(c.timeout_ms&&"undefined"!==typeof g.timeout){g.timeout=c.timeout_ms;
var j=(new Date).getTime()}g.onreadystatechange=function(){if(4===g.readyState)if(200<=g.status&&300>=g.status)f&&f(XMLHttpRequest.responseText);else{var a;a=g.timeout&&!g.status&&(new Date).getTime()-j>=g.timeout?"timeout":"Bad HTTP status: "+g.status+" "+g.statusText;k.error(a);f&&f({status:0,error:a,xhr_req:g})}};g.send(E(b))}catch(i){k.error("failed to send event to moesif"+event.request.uri),k.error(i),f&&f({status:0,error:i})}},initBatching:function(){var a=this._options.applicationId;k.log("does requestBatch.events exists? "+
this.requestBatchers.events);if(!this.requestBatchers.events){var b={libConfig:this._options,sendRequestFunc:c.bind(function(a,b,c,d){this._executeRequest(a,b,c,d)},this)},d=new v("__mf_"+a+"_ev",B+"api.moesif.net/v1/events/batch",b),a=new v("__mf_"+a+"_ac",B+"api.moesif.net/v1/actions/batch",b);this.requestBatchers={events:d,actions:a}}c.each(this.requestBatchers,function(a){a.start()})},_sendOrBatch:function(a,b,c,f,h){var e=!0;this._options.batchEnabled&&f?(k.log("current batcher storage key is  "+
f.queue.storageKey),f.enqueue(a)):e=this._executeRequest(c,a,{applicationId:b},h);return e},start:function(a){function b(a){c.recordEvent(a)}var c=this;if(this._stopRecording||this._stopWeb3Recording)return k.log("recording has already started, please call stop first."),!1;k.log("moesif starting");this._stopRecording=ja(b,this._options);if(!this._options.disableFetch)k.log("also instrumenting fetch API"),this._stopFetchRecording=ma(b);this.useWeb3(a);return!0},useWeb3:function(a){function b(a){c.recordEvent(a)}
var c=this;if(this._stopWeb3Recording)this._stopWeb3Recording(),this._stopWeb3Recording=null;if(a)this._stopWeb3Recording=W(a,b,this._options);else if(window.web3)k.log("found global web3, will capture from it"),this._stopWeb3Recording=W(window.web3,b,this._options);return this._stopWeb3Recording?!0:!1},updateUser:function(a,b,c){this._executeRequest(B+"api.moesif.net/v1/users",a,{applicationId:b},c)},identifyUser:function(a,b){this._userId=a;if(!this._options||!this._options.applicationId)throw Error("Init needs to be called with a valid application Id before calling identify User.");
var c={user_id:a};b&&(c.metadata=b);if(this._session)c.session_token=this._session;if(this._campaign)c.campaign=this._campaign;if(this._companyId)c.company_id=this._companyId;this.updateUser(c,this._options.applicationId,this._options.callback);try{localStorage.setItem("moesif_stored_user_id",a)}catch(f){k.error("error saving to local storage")}},updateCompany:function(a,b,c){this._executeRequest(B+"api.moesif.net/v1/companies",a,{applicationId:b},c)},identifyCompany:function(a,b,c){this._companyId=
a;if(!this._options||!this._options.applicationId)throw Error("Init needs to be called with a valid application Id before calling identify User.");var f={company_id:a};c&&(f.company_domain=c);b&&(f.metadata=b);if(this._session)f.session_token=this._session;if(this._campaign)f.campaign=this._campaign;this.updateCompany(f,this._options.applicationId,this._options.callback);try{localStorage.setItem("moesif_stored_company_id",a)}catch(h){k.error("error saving to local storage")}},identifySession:function(a){this._session=
a;localStorage.setItem("moesif_stored_session_id",a)},track:function(a,b){if(!a)throw Error("track name must have action Name defined");var c={action_name:a};if(this._companyId)c.company_id=this._companyId;if(this._userId)c.user_id=this._userId;if(this._session)c.session_token=this._session;c.request={uri:document.location.href,verb:"GET",user_agent_string:navigator.userAgent};b&&(c.metadata=b);var f=B+"api.moesif.net/v1/actions";k.log("sending or queuing: "+a);return this._sendOrBatch(c,this._options.applicationId,
f,this.requestBatchers.actions,this._options.callback)},recordEvent:function(a){if(Z(a))k.log("skipped logging for requests to moesif");else{k.log("determining if should log: "+a.request.uri);var b=Object.assign({},a);this._getUserId()&&(b.user_id=this._getUserId());this._getCompanyId()&&(b.company_id=this._getCompanyId());this._getSession()&&(b.session_token=this._getSession());b.tags=this._options.getTags(a)||"";if(this._options.apiVersion)b.request.api_version=this._options.apiVersion;this._options.maskContent&&
(b=this._options.maskContent(b));if(this._options.getMetadata)if(b.metadata){var c=this._options.getMetadata(b);b.metadata=Object.assign(b.metadata,c)}else b.metadata=this._options.getMetadata(b);!this._options.skip(a)&&!Z(a)?(k.log("sending or queuing: "+a.request.uri),this._sendOrBatch(b,this._options.applicationId,B+"api.moesif.net/v1/events",this.requestBatchers.events,this._options.callback)):k.log("skipped logging for "+a.request.uri)}},_getUserId:function(){return this._userId},_getCompanyId:function(){return this._companyId},
_getSession:function(){return this._session},stop:function(){if(this._stopRecording)this._stopRecording(),this._stopRecording=null;if(this._stopWeb3Recording)this._stopWeb3Recording(),this._stopWeb3Recording=null;if(this._stopFetchRecording)this._stopFetchRecording(),this._stopFetchRecording=null}}}()})();
})();
