(function() {
(function(){var w,K,L,M,N,B,C,D,E,F,s;function U(a){var c=XMLHttpRequest.prototype,d=c.open,i=c.send,h=c.setRequestHeader;c.open=function(a,c){this._method=a;this._url=c;this._requestHeaders={};this._startTime=(new Date).toISOString();return d.apply(this,arguments)};c.setRequestHeader=function(a,c){this._requestHeaders[a]=c;return h.apply(this,arguments)};c.send=function(c){this.addEventListener("load",function(){var d=(new Date).toISOString();if(a){var h=this._url?this._url.toLowerCase():this._url;
if(h&&0>h.indexOf("moesif.com")&&0>h.indexOf("apirequest.io")){a:if((h=this._url)&&"string"===typeof h){var f=b.trim(h);if(0!==f.indexOf("http")){h=V+window.location.host+"/"+f.replace(/^\./,"").replace(/^\//,"");break a}}h={uri:h,verb:this._method,time:this._startTime,headers:this._requestHeaders};if(c)if("string"===typeof c){g.log("request post data is string");g.log(c);try{h.body=b.JSONDecode(c)}catch(i){g.log("JSON decode failed"),g.log(i),h.transfer_encoding="base64",h.body=b.base64Encode(c)}}else if("object"===
typeof c||Array.isArray(c)||"number"===typeof c||"boolean"===typeof c)h.body=c;var k=this.getAllResponseHeaders(),f={};if(k)for(var k=k.split("\r\n"),l=0;l<k.length;l++){var G=k[l],p=G.indexOf(": ");if(0<p){var m=G.substring(0,p);f[m]=G.substring(p+2)}}d={status:this.status,time:d,headers:f};if(this.responseText)try{d.body=b.JSONDecode(this.responseText)}catch(ca){d.transfer_encoding="base64",d.body=b.base64Encode(this.responseText)}a({request:h,response:d})}}});return i.apply(this,arguments)};return function(){c.open=
d;c.send=i;c.setRequestHeader=h}}function O(a,c,d,i,h,e){c={uri:a&&a.host?a.host:"/",verb:"POST",time:c,headers:{}};if(a.headers){var j={};b.each(a.headers,function(a){j[a.name]=a.value});c.headers=j}if(i)if("string"===typeof i){g.log("request post data is string");g.log(i);try{c.body=b.JSONDecode(i)}catch(n){g.log("JSON decode failed"),g.log(n),c.transfer_encoding="base64",c.body=b.base64Encode(i)}}else if("object"===typeof i||Array.isArray(i)||"number"===typeof i||"boolean"===typeof postData)c.body=
i;d={status:200,time:d,headers:{}};h?d.body=h:e&&(d.body={error:e});h={request:c,response:d,metadata:{_web3:{via_web3_provider:!0,path:a.path,host:a.host}}};a.isMetaMask&&(h.metadata._web3.is_metamask=!0);return h}function P(a,c){if(a.currentProvider){g.log("found my currentProvider, patching it");var b=a.currentProvider,i=b.send,h=b.sendAsync;b.send=function(a){g.log("patched send is called");g.log(a);var h=(new Date).toISOString(),n=i.apply(b,arguments);g.log("patch send result is back");g.log(n);
var f=(new Date).toISOString();c&&c(O(b,h,f,a,n));return n};b.sendAsync=function(a,i){g.log("patched sendAsync is called");g.log(a);var n=(new Date).toISOString();g.log(a);h.apply(b,[a,function(h,o){var k=(new Date).toISOString();g.log("inside patched callback");g.log(o);c&&(g.log("about to record event"),c(O(b,n,k,a,o,h)));g.log("triggering original callback");i(h,o)}])};return function(){b.send=i;b.sendAsync=h}}return null}function W(a){if(!a)return{};g.log("about to decode buffer");g.log(a);g.log(a.byteLength);
if(0>=a.byteLength)return{};try{var c=(new TextDecoder("utf-8")).decode(a);try{return{body:b.JSONDecode(c)}}catch(d){return g.error(d),{transfer_encoding:"base64",body:b.base64Encode(c)}}}catch(i){return g.error(i),g.log(a),{transfer_encoding:"base64",body:"can not be decoded"}}}function Q(a){var c={};g.log("parseheaders is called");for(var a=a.entries(),b=a.next();!b.done;)g.log(b.value),c[b.value[0]]=b.value[1],b=a.next();return c}function X(a,c,b,i,h){try{setTimeout(function(){g.log("interception is here.");
g.log(a);g.log(c);if(a&&c){g.log("inside if statement.");try{Promise.all([a.arrayBuffer(),c.arrayBuffer()]).then(function(e){g.log("processing bodies");var f=e.map(W),e=Object.assign(f[0],{uri:a.url,verb:a.method,time:b,headers:Q(a.headers)}),f=Object.assign(f[1],{status:c.status,time:i,headers:Q(c.headers)});g.log(e);g.log(f);h({request:e,response:f})})}catch(e){g.log("error processing body")}}else g.log("savedRequest")},50)}catch(e){g.error("error processing saved fetch request and response, but move on anyways."),
g.log(e)}}function Y(a,c,b,i){g.log("fetch interceptor is called");var h=null;try{h=new Request(b,i)}catch(e){}var j=(new Date).toISOString(),n=null,f=null;g.log("about to perform fetch.");var f=c(b,i),o=null;return f=f.then(function(c){o=c.clone();n=(new Date).toISOString();X(h,o,j,n,a);return c})}function Z(a,c){var b=c||window||self;if(b.fetch){g.log("found fetch method.");if(b.fetch.polyfill)return g.log("skip patching fetch since it is polyfilled"),null;var i=b.fetch;g.log("fetch is not polyfilled so instrumenting it");
b.fetch=function(c){return function(b,d){return Y(a,c,b,d)}}(b.fetch);return function(){b.fetch=i}}g.log("there is no fetch found")}function $(a,c){var d=a?"?"+a.split(".").slice(-1)[0].replace(/\|/g,"&"):"";g.log("cookie");g.log(d);var i=b.getQueryParamByName(B,c)||b.getQueryParamByName("utmcsr",d),h=b.getQueryParamByName(C,c)||b.getQueryParamByName("utmcmd",d),e=b.getQueryParamByName(D,c)||b.getQueryParamByName("utmccn",d),j=b.getQueryParamByName(E,c)||b.getQueryParamByName("utmctr",d),d=b.getQueryParamByName(F,
c)||b.getQueryParamByName("utmcct",d),n={},f=function(a,c){b.isEmptyString(c)||(n[a]=c)};f(B,i);f(C,h);f(D,e);f(E,j);f(F,d);return n}function aa(a){try{var c={};if(!a.disableUtm)var d=void 0,i=void 0,d=location&&location.search,i=b.cookie.get("__utmz"),c=$(i,d)||{};if(!a.disableReferer){var h;var e=document&&document.referrer,j;if(b.isEmptyString(e))j=void 0;else{var n;if(b.isEmptyString(e))n=null;else{var f=e.split("/");n=3<=f.length?f[2]:null}j={referrer:e,referring_domain:n}}h=j;if(h)c.referrer=
h.referrer,c.referring_domain=h.referring_domain}if(!a.disableRGclid){var o,k=b.getQueryParamByName("gclid",location&&location.search);(o=b.isEmptyString(k)?void 0:k)&&(c.gclid=o)}return c}catch(l){g.error(l)}}function ba(a){if(!a)throw Error("options are required by moesif-express middleware");if(!a.applicationId)throw Error("A moesif application id is required. Please obtain it through your settings at www.moesif.com");if(a.getTags&&!b.isFunction(a.getTags))throw Error("getTags should be a function");
if(a.getMetadata&&!b.isFunction(a.getMetadata))throw Error("getMetadata should be a function");if(a.getApiVersion&&!b.isFunction(a.getApiVersion))throw Error("identifyUser should be a function");if(a.maskContent&&!b.isFunction(a.maskContent))throw Error("maskContent should be a function");if(a.skip&&!b.isFunction(a.skip))throw Error("skip should be a function");}s="1.5.8";var t;t="undefined"===typeof window?{navigator:{}}:window;var H=Array.prototype,R=Object.prototype,u=H.slice,x=R.toString,z=R.hasOwnProperty,
y=t.console,v=t.navigator,q=t.document,m=v.userAgent,I=Function.prototype.bind,S=H.forEach,T=H.indexOf;t=Array.isArray;var J={},b={trim:function(a){return a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},g={log:function(){},error:function(){},critical:function(){if(!b.isUndefined(y)&&y){var a=["Moesif error:"].concat(b.toArray(arguments));try{y.error.apply(y,a)}catch(c){b.each(a,function(a){y.error(a)})}}}};b.bind=function(a,c){var d,i;if(I&&a.bind===I)return I.apply(a,u.call(arguments,1));if(!b.isFunction(a))throw new TypeError;
d=u.call(arguments,2);return i=function(){if(!(this instanceof i))return a.apply(c,d.concat(u.call(arguments)));var b={};b.prototype=a.prototype;var e=new b;b.prototype=null;b=a.apply(e,d.concat(u.call(arguments)));return Object(b)===b?b:e}};b.bind_instance_methods=function(a){for(var c in a)"function"===typeof a[c]&&(a[c]=b.bind(a[c],a))};b.isEmptyString=function(a){return!a||0===a.length};b.each=function(a,c,b){if(!(null===a||void 0===a))if(S&&a.forEach===S)a.forEach(c,b);else if(a.length===+a.length)for(var i=
0,h=a.length;i<h&&!(i in a&&c.call(b,a[i],i,a)===J);i++);else for(i in a)if(z.call(a,i)&&c.call(b,a[i],i,a)===J)break};b.escapeHTML=function(a){a&&b.isString(a)&&(a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"));return a};b.extend=function(a){b.each(u.call(arguments,1),function(c){for(var b in c)void 0!==c[b]&&(a[b]=c[b])});return a};b.isArray=t||function(a){return"[object Array]"===x.call(a)};b.isFunction=function(a){try{return/^\s*\bfunction\b/.test(a)}catch(c){return!1}};
b.isArguments=function(a){return!(!a||!z.call(a,"callee"))};b.toArray=function(a){return!a?[]:a.toArray?a.toArray():b.isArray(a)||b.isArguments(a)?u.call(a):b.values(a)};b.values=function(a){var c=[];if(null===a)return c;b.each(a,function(a){c[c.length]=a});return c};b.identity=function(a){return a};b.include=function(a,c){var d=!1;if(null===a)return d;if(T&&a.indexOf===T)return-1!=a.indexOf(c);b.each(a,function(a){if(d||(d=a===c))return J});return d};b.includes=function(a,c){return-1!==a.indexOf(c)};
b.inherit=function(a,c){a.prototype=new c;a.prototype.constructor=a;a.superclass=c.prototype;return a};b.isObject=function(a){return a===Object(a)&&!b.isArray(a)};b.isEmptyObject=function(a){if(b.isObject(a)){for(var c in a)if(z.call(a,c))return!1;return!0}return!1};b.isUndefined=function(a){return void 0===a};b.isString=function(a){return"[object String]"==x.call(a)};b.isDate=function(a){return"[object Date]"==x.call(a)};b.isNumber=function(a){return"[object Number]"==x.call(a)};b.isElement=function(a){return!!(a&&
1===a.nodeType)};b.encodeDates=function(a){b.each(a,function(c,d){b.isDate(c)?a[d]=b.formatDate(c):b.isObject(c)&&(a[d]=b.encodeDates(c))});return a};b.timestamp=function(){Date.now=Date.now||function(){return+new Date};return Date.now()};b.formatDate=function(a){function c(a){return 10>a?"0"+a:a}return a.getUTCFullYear()+"-"+c(a.getUTCMonth()+1)+"-"+c(a.getUTCDate())+"T"+c(a.getUTCHours())+":"+c(a.getUTCMinutes())+":"+c(a.getUTCSeconds())};b.safewrap=function(a){return function(){try{return a.apply(this,
arguments)}catch(c){g.critical("Implementation error. Please contact support@moesif.com.")}}};b.safewrap_class=function(a,c){for(var d=0;d<c.length;d++)a.prototype[c[d]]=b.safewrap(a.prototype[c[d]])};b.safewrap_instance_methods=function(a){for(var c in a)"function"===typeof a[c]&&(a[c]=b.safewrap(a[c]))};b.strip_empty_properties=function(a){var c={};b.each(a,function(a,i){b.isString(a)&&0<a.length&&(c[i]=a)});return c};b.truncate=function(a,c){var d;"string"===typeof a?d=a.slice(0,c):b.isArray(a)?
(d=[],b.each(a,function(a){d.push(b.truncate(a,c))})):b.isObject(a)?(d={},b.each(a,function(a,h){d[h]=b.truncate(a,c)})):d=a;return d};b.JSONEncode=function(){return function(a){var c=function(a){var c=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,b={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};c.lastIndex=0;return c.test(a)?'"'+a.replace(c,function(a){var c=b[a];return"string"===
typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'},b=function(a,h){var e="",j=0,n=j="",n=0,f=e,g=[],k=h[a];k&&"object"===typeof k&&"function"===typeof k.toJSON&&(k=k.toJSON(a));switch(typeof k){case "string":return c(k);case "number":return isFinite(k)?""+k:"null";case "boolean":case "null":return""+k;case "object":if(!k)return"null";e+="    ";g=[];if("[object Array]"===x.apply(k)){n=k.length;for(j=0;j<n;j+=1)g[j]=b(j,k)||"null";return n=0===g.length?"[]":e?"[\n"+e+
g.join(",\n"+e)+"\n"+f+"]":"["+g.join(",")+"]"}for(j in k)z.call(k,j)&&(n=b(j,k))&&g.push(c(j)+(e?": ":":")+n);return n=0===g.length?"{}":e?"{"+g.join(",")+""+f+"}":"{"+g.join(",")+"}"}};return b("",{"":a})}}();b.JSONDecode=function(){var a,c,b={'"':'"',"\\":"\\","/":"/",b:"\u0008",f:"\u000c",n:"\n",r:"\r",t:"\t"},i,h=function(c){throw{name:"SyntaxError",message:c,at:a,text:i};},e=function(b){b&&b!==c&&h("Expected '"+b+"' instead of '"+c+"'");c=i.charAt(a);a+=1;return c},j=function(){var a;a="";"-"===
c&&(a="-",e("-"));for(;"0"<=c&&"9">=c;)a+=c,e();if("."===c)for(a+=".";e()&&"0"<=c&&"9">=c;)a+=c;if("e"===c||"E"===c){a+=c;e();if("-"===c||"+"===c)a+=c,e();for(;"0"<=c&&"9">=c;)a+=c,e()}a=+a;if(isFinite(a))return a;h("Bad number")},g=function(){var a,f,i="",j;if('"'===c)for(;e();){if('"'===c)return e(),i;if("\\"===c)if(e(),"u"===c){for(f=j=0;4>f;f+=1){a=parseInt(e(),16);if(!isFinite(a))break;j=16*j+a}i+=String.fromCharCode(j)}else if("string"===typeof b[c])i+=b[c];else break;else i+=c}h("Bad string")},
f=function(){for(;c&&" ">=c;)e()},o=function(){switch(c){case "t":return e("t"),e("r"),e("u"),e("e"),!0;case "f":return e("f"),e("a"),e("l"),e("s"),e("e"),!1;case "n":return e("n"),e("u"),e("l"),e("l"),null}h('Unexpected "'+c+'"')},k;k=function(){f();switch(c){case "{":var a;a:{var b,d={};if("{"===c){e("{");f();if("}"===c){e("}");a=d;break a}for(;c;){b=g();f();e(":");Object.hasOwnProperty.call(d,b)&&h('Duplicate key "'+b+'"');d[b]=k();f();if("}"===c){e("}");a=d;break a}e(",");f()}}h("Bad object")}return a;
case "[":a:{a=[];if("["===c){e("[");f();if("]"===c){e("]");b=a;break a}for(;c;){a.push(k());f();if("]"===c){e("]");b=a;break a}e(",");f()}}h("Bad array")}return b;case '"':return g();case "-":return j();default:return"0"<=c&&"9">=c?j():o()}};return function(b){i=b;a=0;c=" ";b=k();f();c&&h("Syntax error");return b}}();b.base64Encode=function(a){var c,d,i,h,e=0,j=0,g="",g=[];if(!a)return a;a=b.utf8Encode(a);do c=a.charCodeAt(e++),d=a.charCodeAt(e++),i=a.charCodeAt(e++),h=c<<16|d<<8|i,c=h>>18&63,d=h>>
12&63,i=h>>6&63,h&=63,g[j++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(i)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h);while(e<a.length);g=g.join("");switch(a.length%3){case 1:g=g.slice(0,-2)+"==";break;case 2:g=g.slice(0,-1)+"="}return g};b.utf8Encode=function(a){var a=(a+"").replace(/\r\n/g,
"\n").replace(/\r/g,"\n"),b="",d,i,h=0,e;d=i=0;h=a.length;for(e=0;e<h;e++){var j=a.charCodeAt(e),g=null;128>j?i++:g=127<j&&2048>j?String.fromCharCode(j>>6|192,j&63|128):String.fromCharCode(j>>12|224,j>>6&63|128,j&63|128);null!==g&&(i>d&&(b+=a.substring(d,i)),b+=g,d=i=e+1)}i>d&&(b+=a.substring(d,a.length));return b};b.UUID=function(){var a=function(){for(var a=1*new Date,b=0;a==1*new Date;)b++;return a.toString(16)+b.toString(16)},b=function(){function a(b,c){var h,d=0;for(h=0;h<c.length;h++)d|=e[h]<<
8*h;return b^d}var b,c,e=[],j=0;for(b=0;b<m.length;b++)c=m.charCodeAt(b),e.unshift(c&255),4<=e.length&&(j=a(j,e),e=[]);0<e.length&&(j=a(j,e));return j.toString(16)};return function(){var d=(screen.height*screen.width).toString(16);return a()+"-"+Math.random().toString(16).replace(".","")+"-"+b()+"-"+d+"-"+a()}}();b.isBlockedUA=function(a){return/(google web preview|baiduspider|yandexbot|bingbot|googlebot|yahoo! slurp)/i.test(a)?!0:!1};b.HTTPBuildQuery=function(a,c){var d,i,h=[];b.isUndefined(c)&&
(c="&");b.each(a,function(a,b){d=encodeURIComponent(a.toString());i=encodeURIComponent(b);h[h.length]=i+"="+d});return h.join(c)};b.getQueryParamByName=function(a,b){var a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),d=RegExp("[\\?&]"+a+"=([^&#]*)").exec(b);return null===d?void 0:decodeURIComponent(d[1].replace(/\+/g," "))};b.getQueryParam=function(a,b){var b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),d=RegExp("[\\?&]"+b+"=([^&#]*)").exec(a);return null===d||d&&"string"!==typeof d[1]&&d[1].length?
"":decodeURIComponent(d[1]).replace(/\+/g," ")};b.getHashParam=function(a,b){var d=a.match(RegExp(b+"=([^&]*)"));return d?d[1]:null};b.cookie={get:function(a){for(var a=a+"=",b=q.cookie.split(";"),d=0;d<b.length;d++){for(var i=b[d];" "==i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(a))return decodeURIComponent(i.substring(a.length,i.length))}return null},parse:function(a){var c;try{c=b.JSONDecode(b.cookie.get(a))||{}}catch(d){}return c},set_seconds:function(a,b,d,i,h){var c;var e="",j="",
g="";i&&(c=(e=(e=q.location.hostname.match(/[a-z0-9][a-z0-9\-]+\.[a-z\.]{2,6}$/i))?e[0]:"")?"; domain=."+e:"",e=c);d&&(j=new Date,j.setTime(j.getTime()+1E3*d),j="; expires="+j.toGMTString());h&&(g="; secure");q.cookie=a+"="+encodeURIComponent(b)+j+"; path=/"+e+g},set:function(a,b,d,i,h){var c;var e="",j="",g="";i&&(c=(e=(e=q.location.hostname.match(/[a-z0-9][a-z0-9\-]+\.[a-z\.]{2,6}$/i))?e[0]:"")?"; domain=."+e:"",e=c);d&&(j=new Date,j.setTime(j.getTime()+864E5*d),j="; expires="+j.toGMTString());
h&&(g="; secure");a=a+"="+encodeURIComponent(b)+j+"; path=/"+e+g;return q.cookie=a},remove:function(a,c){b.cookie.set(a,"",-1,c)}};b.localStorage={error:function(a){g.error("localStorage error: "+a)},get:function(a){try{return window.localStorage.getItem(a)}catch(c){b.localStorage.error(c)}return null},parse:function(a){try{return b.JSONDecode(b.localStorage.get(a))||{}}catch(c){}return null},set:function(a,c){try{window.localStorage.setItem(a,c)}catch(d){b.localStorage.error(d)}},remove:function(a){try{window.localStorage.removeItem(a)}catch(c){b.localStorage.error(c)}}};
b.dom_query=function(){function a(a,b){var c;return 0<=(" "+a.className+" ").replace(d," ").indexOf(" "+b+" ")}function c(c){if(!q.getElementsByTagName)return[];var c=c.split(" "),h,e,d,g,f,o,k,l=[q];for(g=0;g<c.length;g++)if(h=c[g].replace(/^\s+/,"").replace(/\s+$/,""),-1<h.indexOf("#")){e=h.split("#");h=e[0];l=q.getElementById(e[1]);if(!l||h&&l.nodeName.toLowerCase()!=h)return[];l=[l]}else if(-1<h.indexOf(".")){e=h.split(".");h=e[0];var m=e[1];h||(h="*");e=[];for(f=d=0;f<l.length;f++){k="*"==h?
l[f].all?l[f].all:l[f].getElementsByTagName("*"):l[f].getElementsByTagName(h);for(o=0;o<k.length;o++)e[d++]=k[o]}l=[];for(f=h=0;f<e.length;f++)e[f].className&&b.isString(e[f].className)&&a(e[f],m)&&(l[h++]=e[f])}else if(e=h.match(/^(\w*)\[(\w+)([=~\|\^\$\*]?)=?"?([^\]"]*)"?\]$/)){h=e[1];var p=e[2],m=e[3],r=e[4];h||(h="*");e=[];for(f=d=0;f<l.length;f++){k="*"==h?l[f].all?l[f].all:l[f].getElementsByTagName("*"):l[f].getElementsByTagName(h);for(o=0;o<k.length;o++)e[d++]=k[o]}l=[];h=0;switch(m){case "=":m=
function(a){return a.getAttribute(p)==r};break;case "~":m=function(a){return a.getAttribute(p).match(RegExp("\\b"+r+"\\b"))};break;case "|":m=function(a){return a.getAttribute(p).match(RegExp("^"+r+"-?"))};break;case "^":m=function(a){return 0===a.getAttribute(p).indexOf(r)};break;case "$":m=function(a){return a.getAttribute(p).lastIndexOf(r)==a.getAttribute(p).length-r.length};break;case "*":m=function(a){return-1<a.getAttribute(p).indexOf(r)};break;default:m=function(a){return a.getAttribute(p)}}l=
[];for(f=h=0;f<e.length;f++)m(e[f])&&(l[h++]=e[f])}else{e=[];for(f=d=0;f<l.length;f++){k=l[f].getElementsByTagName(h);for(o=0;o<k.length;o++)e[d++]=k[o]}l=e}return l}var d=/[\t\r\n]/g;return function(a){return b.isElement(a)?[a]:b.isObject(a)&&!b.isUndefined(a.length)?a:c.call(this,a)}}();b.info={campaignParams:function(){var a="utm_source utm_medium utm_campaign utm_content utm_term".split(" "),c="",d={};b.each(a,function(a){c=b.getQueryParam(q.URL,a);c.length&&(d[a]=c)});return d},searchEngine:function(a){return 0===
a.search("https?://(.*)google.([^/?]*)")?"google":0===a.search("https?://(.*)bing.com")?"bing":0===a.search("https?://(.*)yahoo.com")?"yahoo":0===a.search("https?://(.*)duckduckgo.com")?"duckduckgo":null},searchInfo:function(a){var c=b.info.searchEngine(a),d;d={};if(null!==c)d.$search_engine=c,a=b.getQueryParam(a,"yahoo"!=c?"q":"p"),a.length&&(d.mp_keyword=a);return d},browser:function(a,c,d){c=c||"";return d||b.includes(a," OPR/")?b.includes(a,"Mini")?"Opera Mini":"Opera":/(BlackBerry|PlayBook|BB10)/i.test(a)?
"BlackBerry":b.includes(a,"IEMobile")||b.includes(a,"WPDesktop")?"Internet Explorer Mobile":b.includes(a,"Edge")?"Microsoft Edge":b.includes(a,"FBIOS")?"Facebook Mobile":b.includes(a,"Chrome")?"Chrome":b.includes(a,"CriOS")?"Chrome iOS":b.includes(a,"UCWEB")||b.includes(a,"UCBrowser")?"UC Browser":b.includes(a,"FxiOS")?"Firefox iOS":b.includes(c,"Apple")?b.includes(a,"Mobile")?"Mobile Safari":"Safari":b.includes(a,"Android")?"Android Mobile":b.includes(a,"Konqueror")?"Konqueror":b.includes(a,"Firefox")?
"Firefox":b.includes(a,"MSIE")||b.includes(a,"Trident/")?"Internet Explorer":b.includes(a,"Gecko")?"Mozilla":""},browserVersion:function(a,c,d){c={"Internet Explorer Mobile":/rv:(\d+(\.\d+)?)/,"Microsoft Edge":/Edge\/(\d+(\.\d+)?)/,Chrome:/Chrome\/(\d+(\.\d+)?)/,"Chrome iOS":/CriOS\/(\d+(\.\d+)?)/,"UC Browser":/(UCBrowser|UCWEB)\/(\d+(\.\d+)?)/,Safari:/Version\/(\d+(\.\d+)?)/,"Mobile Safari":/Version\/(\d+(\.\d+)?)/,Opera:/(Opera|OPR)\/(\d+(\.\d+)?)/,Firefox:/Firefox\/(\d+(\.\d+)?)/,"Firefox iOS":/FxiOS\/(\d+(\.\d+)?)/,
Konqueror:/Konqueror:(\d+(\.\d+)?)/,BlackBerry:/BlackBerry (\d+(\.\d+)?)/,"Android Mobile":/android\s(\d+(\.\d+)?)/,"Internet Explorer":/(rv:|MSIE )(\d+(\.\d+)?)/,Mozilla:/rv:(\d+(\.\d+)?)/}[b.info.browser(a,c,d)];if(void 0===c)return null;a=a.match(c);return!a?null:parseFloat(a[a.length-2])},os:function(){return/Windows/i.test(m)?/Phone/.test(m)||/WPDesktop/.test(m)?"Windows Phone":"Windows":/(iPhone|iPad|iPod)/.test(m)?"iOS":/Android/.test(m)?"Android":/(BlackBerry|PlayBook|BB10)/i.test(m)?"BlackBerry":
/Mac/i.test(m)?"Mac OS X":/Linux/.test(m)?"Linux":""},device:function(a){return/Windows Phone/i.test(a)||/WPDesktop/.test(a)?"Windows Phone":/iPad/.test(a)?"iPad":/iPod/.test(a)?"iPod Touch":/iPhone/.test(a)?"iPhone":/(BlackBerry|PlayBook|BB10)/i.test(a)?"BlackBerry":/Android/.test(a)?"Android":""},referringDomain:function(a){a=a.split("/");return 3<=a.length?a[2]:""},properties:function(){return b.extend(b.strip_empty_properties({$os:b.info.os(),$browser:b.info.browser(m,v.vendor,window.opera),$referrer:q.referrer,
$referring_domain:b.info.referringDomain(q.referrer),$device:b.info.device(m)}),{$current_url:window.location.href,$browser_version:b.info.browserVersion(m,v.vendor,window.opera),$screen_height:screen.height,$screen_width:screen.width,mp_lib:"web",$lib_version:s})},people_properties:function(){return b.extend(b.strip_empty_properties({$os:b.info.os(),$browser:b.info.browser(m,v.vendor,window.opera)}),{$browser_version:b.info.browserVersion(m,v.vendor,window.opera)})},pageviewInfo:function(a){return b.strip_empty_properties({mp_page:a,
mp_referrer:q.referrer,mp_browser:b.info.browser(m,v.vendor,window.opera),mp_platform:b.info.os()})}};b.toArray=b.toArray;b.isObject=b.isObject;b.JSONEncode=b.JSONEncode;b.JSONDecode=b.JSONDecode;b.isBlockedUA=b.isBlockedUA;b.isEmptyObject=b.isEmptyObject;b.isEmptyString=b.isEmptyString;b.each=b.each;b.info=b.info;b.info.device=b.info.device;b.info.browser=b.info.browser;b.info.properties=b.info.properties;var V="http:"===(document&&document.location.protocol)?"http://":"https://";B="utm_source";
C="utm_medium";D="utm_campaign";E="utm_term";F="utm_content";w="api.moesif.net";K="/v1/events";L="/v1/actions";M="/v1/users";N="/v1/companies";var A="http:"===(document&&document.location.protocol)?"http://":"https://";window.moesif=function(){function a(a,c,d,i){g.log("actually sending to log event "+b.JSONEncode(a));var f=new XMLHttpRequest;f.open("POST",A+w+K);f.setRequestHeader("Content-Type","application/json");f.setRequestHeader("X-Moesif-Application-Id",c);f.setRequestHeader("X-Moesif-SDK",
"moesif-browser-js/"+s);f.onreadystatechange=function(){4===f.readyState&&(200<=f.status&&300>=f.status?d&&g.log("sent to moesif successfully: "+a.request.uri):(g.log("failed to sent to moesif: "+a.request.uri),d&&g.error(f.statusText),i&&b.isFunction(i)&&i(Error("can not sent to moesif"),a)))};f.send(b.JSONEncode(a))}function c(a,c,d,i){g.log("actually sending action to moesif"+b.JSONEncode(a));var f=new XMLHttpRequest;f.open("POST",A+w+L);f.setRequestHeader("Content-Type","application/json");f.setRequestHeader("X-Moesif-Application-Id",
c);f.setRequestHeader("X-Moesif-SDK","moesif-browser-js/"+s);f.onreadystatechange=function(){4===f.readyState&&(200<=f.status&&300>=f.status?d&&g.log("sent action to moesif successfully: "+(a&&a.action_name)):(g.log("failed to sent action to moesif: "+(a&&a.action_name)),d&&g.error(f.statusText),i&&b.isFunction(i)&&i(Error("can not sent to moesif"),event)))};f.send(b.JSONEncode(a))}function d(a,c,d,i){var f=new XMLHttpRequest;f.open("POST",A+w+M);f.setRequestHeader("Content-Type","application/json");
f.setRequestHeader("X-Moesif-Application-Id",c);f.setRequestHeader("X-Moesif-SDK","moesif-browser-js/"+s);f.onreadystatechange=function(){4===f.readyState&&(200<=f.status&&300>=f.status?d&&g.log("update user to moesif successfully: "+a.user_id):(g.log("update user to moesif failed "+a.user_id),d&&g.error(f.statusText),i&&b.isFunction(i)&&i(Error("can not update user to moesif"),null,a)))};f.send(b.JSONEncode(a))}function i(a,c,d,i){var f=new XMLHttpRequest;f.open("POST",A+w+N);f.setRequestHeader("Content-Type",
"application/json");f.setRequestHeader("X-Moesif-Application-Id",c);f.setRequestHeader("X-Moesif-SDK","moesif-browser-js/"+s);f.onreadystatechange=function(){4===f.readyState&&(200<=f.status&&300>=f.status?d&&g.log("update company to moesif successfully: "+a.company_id):(g.log("update company to moesif failed "+a.company_id),d&&g.error(f.statusText),i&&b.isFunction(i)&&i(Error("can not update company to moesif"),null,a)))};f.send(b.JSONEncode(a))}g.log("moesif object creator is called");return{init:function(a){window||
g.critical("Warning, this library need to be initiated on the client side");ba(a);var b={};b.getTags=a.getTags||function(){};b.maskContent=a.maskContent||function(a){return a};b.getMetadata=a.getMetadata||function(){};b.skip=a.skip||function(){return!1};b.debug=a.debug;b.callback=a.callback;b.applicationId=a.applicationId;b.apiVersion=a.apiVersion;b.disableFetch=a.disableFetch;b.disableReferrer=a.disableReferrer;b.disableGclid=a.disableGclid;b.disableUtm=a.disableUtm;this._options=b;this._userId=
localStorage.getItem("moesif_stored_user_id");this._session=localStorage.getItem("moesif_stored_session_id");this._companyId=localStorage.getItem("moesif_stored_company_id");this._campaign=aa(b);g.log("moesif initiated");return this},start:function(a){function b(a){c.recordEvent(a)}var c=this;if(this._stopRecording||this._stopWeb3Recording)return g.log("recording has already started, please call stop first."),!1;g.log("moesif starting");this._stopRecording=U(b);if(!this._options.disableFetch)g.log("also instrumenting fetch API"),
this._stopFetchRecording=Z(b);this.useWeb3(a);return!0},useWeb3:function(a){function b(a){c.recordEvent(a)}var c=this;if(this._stopWeb3Recording)this._stopWeb3Recording(),this._stopWeb3Recording=null;if(a)this._stopWeb3Recording=P(a,b,this._options);else if(window.web3)g.log("found global web3, will capture from it"),this._stopWeb3Recording=P(window.web3,b,this._options);return this._stopWeb3Recording?!0:!1},identifyUser:function(a,b){this._userId=a;if(!this._options||!this._options.applicationId)throw Error("Init needs to be called with a valid application Id before calling identify User.");
var c={user_id:a};b&&(c.metadata=b);if(this._session)c.session_token=this._session;if(this._campaign)c.campaign=this._campaign;if(this._companyId)c.company_id=this._companyId;d(c,this._options.applicationId,this._options.debug,this._options.callback);localStorage.setItem("moesif_stored_user_id",a)},identifyCompany:function(a,b,c){this._companyId=a;if(!this._options||!this._options.applicationId)throw Error("Init needs to be called with a valid application Id before calling identify User.");var d=
{company_id:a};c&&(d.company_domain=c);b&&(d.metadata=b);if(this._session)d.session_token=this._session;if(this._campaign)d.campaign=this._campaign;i(d,this._options.applicationId,this._options.debug,this._options.callback);localStorage.setItem("moesif_stored_company_id",a)},identifySession:function(a){this._session=a;localStorage.setItem("moesif_stored_session_id",a)},track:function(a,b){if(!a)throw Error("track name must have action Name defined");var d={action_name:a};if(this._companyId)d.company_id=
this._companyId;if(this._userId)d.user_id=this._userId;if(this._session)d.session_token=this._session;d.request={uri:document.location.href,verb:"GET",user_agent_string:navigator.userAgent};b&&(d.metadata=b);c(d,this._options.applicationId,this._options.debug,this._options.callback)},recordEvent:function(b){g.log("determining if should log: "+b.request.uri);var c=Object.assign({},b);this._getUserId()&&(c.user_id=this._getUserId());this._getCompanyId()&&(c.company_id=this._getCompanyId());this._getSession()&&
(c.session_token=this._getSession());c.tags=this._options.getTags(b)||"";if(this._options.apiVersion)c.request.api_version=this._options.apiVersion;this._options.maskContent&&(c=this._options.maskContent(c));if(this._options.getMetadata)if(c.metadata){var d=this._options.getMetadata(c);c.metadata=Object.assign(c.metadata,d)}else c.metadata=this._options.getMetadata(c);!this._options.skip(b)&&!b.request.headers["X-Moesif-SDK"]?a(c,this._options.applicationId,this._options.debug,this._options.callback):
g.log("skipped logging for "+b.request.uri)},_getUserId:function(){return this._userId},_getCompanyId:function(){return this._companyId},_getSession:function(){return this._session},stop:function(){if(this._stopRecording)this._stopRecording(),this._stopRecording=null;if(this._stopWeb3Recording)this._stopWeb3Recording(),this._stopWeb3Recording=null;if(this._stopFetchRecording)this._stopFetchRecording(),this._stopFetchRecording=null}}}()})();
})();
