(function() {
(function(){var ga,ha,ia,ja,ka,la,ma,L,M,N,O,P,W;function na(a,b,d){p.log("processResponse for"+a._url);var f=(new Date).toISOString();if(d){var h=a._url?a._url.toLowerCase():a._url;if(h&&0>h.indexOf("moesif.com")&&0>h.indexOf("apirequest.io")){a:if((h=a._url)&&"string"===typeof h){var e=c.trim(h);if(0!==e.indexOf("http")){h=Ha+window.location.host+"/"+e.replace(/^\./,"").replace(/^\//,"");break a}}h={uri:h,verb:a._method,time:a._startTime,headers:a._requestHeaders};if(b)if("string"===typeof b)p.log("request post data is string"),
p.log(b),b=X(b),h.transfer_encoding=b.transfer_encoding,h.body=b.body;else if("object"===typeof b||Array.isArray(b)||"number"===typeof b||"boolean"===typeof b)h.body=b;e=a.getAllResponseHeaders();p.log("rawResponseHeaders are "+e);b={};if(e)for(var e=e.split("\r\n"),i=0;i<e.length;i++){var k=e[i],g=k.indexOf(": ");if(0<g){var l=k.substring(0,g);b[l]=k.substring(g+2)}}e=a.status;1223===e&&(e=204);f={status:e,time:f,headers:b};p.log("responseType: "+a.responseType);p.log("responseText: "+a.responseText);
p.log("response: "+a.response);b=a.responseText;e={};if(b)e=X(b),f.body=e.body,f.transfer_encoding=e.transfer_encoding;else if(a.response)if(p.log("no responseText trying with xhr.response"),c.isString(a.response))p.log("response is string. attempt to parse"),e=X(a.response),f.body=e.body,f.transfer_encoding=e.transfer_encoding;else if(c.isArrayBuffer(a.response))p.log("response is arraybuffer. attempt to parse"),e=oa(a.response),f.body=e.body,f.transfer_encoding=e.transfer_encoding;else if(c.isArray(a.response)||
c.isObject(a.response))f.body=a.response;d({request:h,response:f})}}}function Ia(a,b){var d=XMLHttpRequest.prototype,f=b&&b.eagerBodyLogging,h=d.open,e=d.send,i=d.setRequestHeader;d.open=function(a,b){p.log("XHR open triggered");this._method=a;this._url=b;this._requestHeaders={};this._startTime=(new Date).toISOString();return h.apply(this,arguments)};d.setRequestHeader=function(a,b){this._requestHeaders[a]=b;return i.apply(this,arguments)};d.send=function(b){p.log("XHR send started for "+this._url);
var d=this;if(f||!this.addEventListener){var h=this.onreadystatechange;this.onreadystatechange=function(){var f=d.readyState;p.log("readyState "+f);f===XMLHttpRequest.DONE&&(p.log("XHR onreadystatechange DONE triggered for "+d._url),na(d,b,a));if(h&&c.isFunction(h))return p.log("trigger old onreadystatechange"),h.apply(this,arguments)}}else this.addEventListener("loadend",function(){p.log("XHR loadend triggered for "+d._url);na(d,b,a)});return e.apply(this,arguments)};return function(){d.open=h;d.send=
e;d.setRequestHeader=i}}function pa(a,b,d,f,h,e){b={uri:a&&a.host?a.host:"/",verb:"POST",time:b,headers:{}};if(a.headers){var i={};c.each(a.headers,function(a){i[a.name]=a.value});b.headers=i}if(f)if("string"===typeof f){u.log("request post data is string");u.log(f);try{b.body=c.JSONDecode(f)}catch(k){u.log("JSON decode failed"),u.log(k),b.transfer_encoding="base64",b.body=c.base64Encode(f)}}else if("object"===typeof f||Array.isArray(f)||"number"===typeof f||"boolean"===typeof postData)b.body=f;d=
{status:200,time:d,headers:{}};h?d.body=h:e&&(d.body={error:e});h={request:b,response:d,metadata:{_web3:{via_web3_provider:!0,path:a.path,host:a.host}}};a.isMetaMask&&(h.metadata._web3.is_metamask=!0);return h}function qa(a,b){if(a.currentProvider){u.log("found my currentProvider, patching it");var d=a.currentProvider,c=d.send,h=d.sendAsync;d.send=function(a){u.log("patched send is called");u.log(a);var h=(new Date).toISOString(),k=c.apply(d,arguments);u.log("patch send result is back");u.log(k);
var g=(new Date).toISOString();b&&b(pa(d,h,g,a,k));return k};d.sendAsync=function(a,c){u.log("patched sendAsync is called");u.log(a);var f=(new Date).toISOString();h.apply(d,[a,function(h,l){var n=(new Date).toISOString();u.log("inside patched callback");u.log(l);b&&b(pa(d,f,n,a,l,h));c&&c(h,l)}])};return function(){d.send=c;d.sendAsync=h}}return null}function ra(a){var b={};r.log("parseheaders is called");for(var a=a.entries(),d=a.next();!d.done;)r.log(d.value),b[d.value[0]]=d.value[1],d=a.next();
return b}function Ja(a,b,d,c,h){try{setTimeout(function(){r.log("interception is here.");r.log(a);r.log(b);if(a&&b)try{Promise.all([a.arrayBuffer(),b.arrayBuffer()]).then(function(e){var g=e.map(oa),e=Object.assign(g[0],{uri:a.url,verb:a.method,time:d,headers:ra(a.headers)}),g=Object.assign(g[1],{status:b.status,time:c,headers:ra(b.headers)});r.log(e);r.log(g);h({request:e,response:g})})}catch(e){r.error("error processing body")}else r.log("savedRequest")},50)}catch(e){r.error("error processing saved fetch request and response, but move on anyways."),
r.log(e)}}function Ka(a,b,d,c){var h=null;try{h=new Request(d,c)}catch(e){}var i=(new Date).toISOString(),k=null,g=null,g=b(d,c),l=null;return g=g.then(function(b){l=b.clone();k=(new Date).toISOString();Ja(h,l,i,k,a);return b})}function La(a,b){var d=b||window||self;if(d.fetch){r.log("found fetch method.");if(d.fetch.polyfill)return r.log("skip patching fetch since it is polyfilled"),null;var c=d.fetch;r.log("fetch is not polyfilled so instrumenting it");d.fetch=function(b){return function(d,c){return Ka(a,
b,d,c)}}(d.fetch);return function(){d.fetch=c}}r.log("there is no fetch found, so skipping instrumentation.")}function Ma(a,b){var d=a?"?"+a.split(".").slice(-1)[0].replace(/\|/g,"&"):"";sa.log("cookie");sa.log(d);var f=c.getQueryParamByName(q.UTM_SOURCE,b)||c.getQueryParamByName("utmcsr",d),h=c.getQueryParamByName(q.UTM_MEDIUM,b)||c.getQueryParamByName("utmcmd",d),e=c.getQueryParamByName(q.UTM_CAMPAIGN,b)||c.getQueryParamByName("utmccn",d),i=c.getQueryParamByName(q.UTM_TERM,b)||c.getQueryParamByName("utmctr",
d),d=c.getQueryParamByName(q.UTM_CONTENT,b)||c.getQueryParamByName("utmcct",d),k={},g=function(a,b){c.isEmptyString(b)||(k[a]=b)};g(q.UTM_SOURCE,f);g(q.UTM_MEDIUM,h);g(q.UTM_CAMPAIGN,e);g(q.UTM_TERM,i);g(q.UTM_CONTENT,d);return k}function v(a,b){return!b?a:0===a.indexOf("moesif_")?a.replace("moesif_",b):a}function Na(a){var b=a.persistence;if("cookie"!==b&&"localStorage"!==b)j.critical("Unknown persistence type "+b+"; falling back to cookie"),b=G.persistence="localStorage";var d=a.persistence_key_prefix,
f=function(b,e){var f=v(b,d);c.localStorage.set(f,e);c.cookie.set(f,e,a.cookie_expiration,a.cross_subdomain_cookie,a.secure_cookie,a.cross_site_cookie,a.cookie_domain)};if("cookie"===b||!c.localStorage.is_supported())f=function(b,f){var i=v(b,d);c.cookie.set(i,f,a.cookie_expiration,a.cross_subdomain_cookie,a.secure_cookie,a.cross_site_cookie,a.cookie_domain)};"none"===b&&(f=function(){});return f}function Y(a){return"null"===a||"undefined"===a||""===a?null:a}function H(a,b){var d=b&&b.persistence,
f=v(a,b&&b.persistence_key_prefix);if(c.localStorage.is_supported()){var h=Y(c.localStorage.get(f)),e=Y(c.cookie.get(f));!h&&e&&"localStorage"===d&&c.localStorage.set(f,e);return h||e}return Y(c.cookie.get(f))}function ta(a){a=a&&a.persistence_key_prefix;c.cookie.remove(v(L,a));c.cookie.remove(v(M,a));c.cookie.remove(v(N,a));c.cookie.remove(v(O,a));c.cookie.remove(v(P,a))}function ua(a){a=a&&a.persistence_key_prefix;c.localStorage.remove(v(L,a));c.localStorage.remove(v(M,a));c.localStorage.remove(v(N,
a));c.localStorage.remove(v(O,a));c.localStorage.remove(v(P,a))}function Oa(a,b){var d=null,f=null;try{(f=H(P,b))&&"null"!==f&&(d=c.JSONDecode(f))}catch(h){y.error("failed to decode campaign data "+f),y.error(h)}var e;a:{try{f={};if(!b.disableUtm)var i=void 0,k=void 0,i=c.getUrlParams(),k=c.cookie.get("__utmz"),f=Ma(k,i)||{};if(!b.disableReferer){var g;b:{var l=document&&document.referrer;va.log(l);if(!c.isEmptyString(l))if(0===l.indexOf(location.protocol+"//"+location.host))va.log("referrer is the same so skipping");
else{var n;if(c.isEmptyString(l))n=null;else{var wa=l.split("/");n=3<=wa.length?wa[2]:null}g={referrer:l,referring_domain:n};break b}g=void 0}if(g)f.referrer=g.referrer,f.referring_domain=g.referring_domain}if(!b.disableRGclid){var j,Pa=c.getUrlParams(),m=c.getQueryParamByName("gclid",Pa);(j=c.isEmptyString(m)?void 0:m)&&(f.gclid=j)}e=f;break a}catch(Qa){y.log(Qa)}e=void 0}y.log("current campaignData");y.log(c.JSONEncode(e));var t;if(e)if(d){g=c.extend({},d,e);if(e&&e[q.UTM_SOURCE])for(t in q)g[q[t]]=
e[q[t]];t=g}else t=e;else t=d;y.log("merged campaignData");y.log(c.JSONEncode(t));try{if(a&&t&&!c.isEmptyObject(t)){var o=c.JSONEncode(t);a(P,o);!d&&t[q.UTM_SOURCE]&&a(W,o)}}catch(p){y.error("failed to persist campaign data"),y.error(p)}return t}function Z(a){var b=c.UUID();a&&a(N,b);return b}function Ra(a,b){var d=H(N,b);return d?d:Z(a)}function xa(a){try{return a.request.headers["X-Moesif-SDK"]}catch(b){return!1}}function Sa(a){if(!a)throw Error("options are required by moesif-browser-js middleware");
if(!a.applicationId)throw Error("A moesif application id is required. Please obtain it through your settings at www.moesif.com");if(a.getTags&&!c.isFunction(a.getTags))throw Error("getTags should be a function");if(a.getMetadata&&!c.isFunction(a.getMetadata))throw Error("getMetadata should be a function");if(a.getApiVersion&&!c.isFunction(a.getApiVersion))throw Error("identifyUser should be a function");if(a.maskContent&&!c.isFunction(a.maskContent))throw Error("maskContent should be a function");
if(a.skip&&!c.isFunction(a.skip))throw Error("skip should be a function");}function ya(){j.log("moesif object creator is called");return{init:function(a){window||j.critical("Warning, this library need to be initiated on the client side");Sa(a);var b={};b.getTags=a.getTags||$;b.maskContent=a.maskContent||function(a){return a};b.getMetadata=a.getMetadata||$;b.skip=a.skip||function(){return!1};b.debug=a.debug;b.callback=a.callback||$;b.applicationId=a.applicationId;b.apiVersion=a.apiVersion;b.disableFetch=
a.disableFetch;b.disableReferrer=a.disableReferrer;b.disableGclid=a.disableGclid;b.disableUtm=a.disableUtm;b.eagerBodyLogging=a.eagerBodyLogging;b.host=a.host||ga;b.batchEnabled=a.batchEnabled||!1;b.batch_size=a.batchSize||25;b.batch_flush_interval_ms=a.batchMaxTime||2500;b.batch_request_timeout_ms=a.batchTimeout||9E4;b.batch_storage_expiration=a.batchStorageExpiration;b.persistence=a.persistence||"localStorage";b.cross_site_cookie=a.crossSiteCookie||!1;b.cross_subdomain_cookie=!1===a.crossSubdomainCookie?
!1:!0;b.cookie_expiration=a.cookieExpiration||365;b.secure_cookie=a.secureCookie||!1;b.cookie_domain=a.cookieDomain||"";b.persistence_key_prefix=a.persistenceKeyPrefix;this.requestBatchers={};this._options=b;this._persist=Na(b);try{if(this._userId=H(L,b),this._session=H(O,b),this._companyId=H(M,b),this._anonymousId=Ra(this._persist,b),(this._campaign=Oa(this._persist,b))&&!this._userId)a={},a.anonymous_id=this._anonymousId,a.campaign=this._campaign,this.updateUser(a,this._options.applicationId,this._options.host,
this._options.callback)}catch(d){j.error("error loading saved data from local storage but continue")}if(b.batchEnabled)if(!Q()||!za)b.batchEnabled=!1,j.log("Turning off batch processing because it needs XHR and localStorage");else if(this.initBatching(),Aa&&window.addEventListener){var f=c.bind(function(){c.each(this.requestBatchers,function(a){a.stopped||a.flush({sendBeacon:!0})})},this);window.addEventListener("pagehide",function(){f()});window.addEventListener("visibilitychange",function(){"hidden"===
document.visibilityState&&f()})}j.log("moesif initiated");return this},_executeRequest:function(a,b,d,c){var h=d&&d.applicationId||this._options.applicationId,e=d&&d.method||"POST";try{var i=new XMLHttpRequest;i.open(e,a);i.setRequestHeader("Content-Type","application/json");i.setRequestHeader("X-Moesif-Application-Id",h);i.setRequestHeader("X-Moesif-SDK","moesif-browser-js/"+G.LIB_VERSION);if(d.timeout_ms&&"undefined"!==typeof i.timeout){i.timeout=d.timeout_ms;var k=(new Date).getTime()}i.onreadystatechange=
function(){if(4===i.readyState)if(200<=i.status&&300>=i.status)c&&c(XMLHttpRequest.responseText);else{var a;a=i.timeout&&!i.status&&(new Date).getTime()-k>=i.timeout?"timeout":"Bad HTTP status: "+i.status+" "+i.statusText;j.error(a);c&&c({status:0,error:a,xhr_req:i})}};i.send(E(b))}catch(g){j.error("failed to send to moesif "+(b&&b.request&&b.request.uri)),j.error(g),c&&c({status:0,error:g})}},initBatching:function(){var a=this._options.applicationId,b=this._options.host;j.log("does requestBatch.events exists? "+
this.requestBatchers.events);if(!this.requestBatchers.events){var d={libConfig:this._options,sendRequestFunc:c.bind(function(a,b,d,c){this._executeRequest(a,b,d,c)},this),stopAllBatching:c.bind(function(){this.stopAllBatching()},this)},f=Ba(a),a=new A("__mf_"+f+"_ev",I+b+ha,d),b=new A("__mf_"+f+"_ac",I+b+ia,d);this.requestBatchers={events:a,actions:b}}c.each(this.requestBatchers,function(a){a.start()})},stopAllBatching:function(){this._options.batchEnabled=!1;c.each(this.requestBatchers,function(a){a.stop();
a.clear()})},_sendOrBatch:function(a,b,d,f,h){var e=this,i=function(){return e._executeRequest(d,a,{applicationId:b},h)};if(this._options.batchEnabled&&f){j.log("current batcher storage key is  "+f.queue.storageKey);var k=c.bind(function(a){a||(j.log("enqueue failed, send immediately"),i())},this);f.enqueue(a,k)}else return i();return!0},start:function(a){function b(a){d.recordEvent(a)}var d=this;if(this._stopRecording||this._stopWeb3Recording)return j.log("recording has already started, please call stop first."),
!1;j.log("moesif starting");this._stopRecording=Ia(b,this._options);if(!this._options.disableFetch)j.log("also instrumenting fetch API"),this._stopFetchRecording=La(b);this.useWeb3(a);return!0},useWeb3:function(a){function b(a){d.recordEvent(a)}var d=this;try{if(this._stopWeb3Recording)this._stopWeb3Recording(),this._stopWeb3Recording=null;if(a)this._stopWeb3Recording=qa(a,b,this._options);else if(window.web3)j.log("found global web3, will capture from it"),this._stopWeb3Recording=qa(window.web3,
b,this._options);if(this._stopWeb3Recording)return!0}catch(c){j.log("error patching web3, moving forward anyways"),this._options.callback&&this._options.callback({status:0,error:c,message:"failed to instrument web3, but moving forward with other instrumentation"})}return!1},updateUser:function(a,b,d,c){this._executeRequest(I+d+ja,a,{applicationId:b},c)},identifyUser:function(a,b){if(c.isNil(a))j.critical("identifyUser called with nil userId");else{this._userId=a;if(!this._options||!this._options.applicationId)throw Error("Init needs to be called with a valid application Id before calling identify User.");
var d={user_id:a};b&&(d.metadata=b);if(this._session)d.session_token=this._session;if(this._campaign)d.campaign=this._campaign;if(this._companyId)d.company_id=this._companyId;d.anonymous_id=this._anonymousId;this.updateUser(d,this._options.applicationId,this._options.host,this._options.callback);try{a&&this._persist(L,a)}catch(f){j.error("error saving to local storage")}}},updateCompany:function(a,b,d,c){this._executeRequest(I+d+ka,a,{applicationId:b},c)},identifyCompany:function(a,b,d){if(c.isNil(a))j.critical("identifyCompany called with nil companyId.");
else{var f=!!this._companyId;this._companyId=a;if(!this._options||!this._options.applicationId)throw Error("Init needs to be called with a valid application Id before calling identify User.");var h={company_id:a};d&&(h.company_domain=d);b&&(h.metadata=b);if(this._session)h.session_token=this._session;if(f)b=this._campaign;else{d=b=null;try{(d=H(W,this._options))&&(b=c.JSONDecode(d))}catch(e){y.error("failed to decode company campaign data "+d),y.error(e)}b=b||this._campaign}b&&(h.campaign=b);this.updateCompany(h,
this._options.applicationId,this._options.host,this._options.callback);try{a&&this._persist(M,a)}catch(i){j.error("error saving to local storage")}}},identifySession:function(a){if(c.isNil(a))j.critical("identifySession called with nil");else if(this._session=a)try{this._persist(O,a)}catch(b){j.error("local storage error")}},track:function(a,b){if(!a)throw Error("track name must have action Name defined");var d={action_name:a};if(this._companyId)d.company_id=this._companyId;this._userId?d.user_id=
this._userId:d.anonymous_id=this._anonymousId;if(this._session)d.session_token=this._session;d.request={uri:document.location.href,verb:"GET",user_agent_string:navigator.userAgent};b&&(d.metadata=b);var c=I+this._options.host+la;j.log("sending or queuing: "+a);return this._sendOrBatch(d,this._options.applicationId,c,this.requestBatchers.actions,this._options.callback)},recordEvent:function(a){if(xa(a))j.log("skipped logging for requests to moesif");else{j.log("determining if should log: "+a.request.uri);
var b=Object.assign({},a);this._getUserId()?b.user_id=this._getUserId():b.anonymous_id=this._anonymousId;this._getCompanyId()&&(b.company_id=this._getCompanyId());this._getSession()&&(b.session_token=this._getSession());b.tags=this._options.getTags(a)||"";if(this._options.apiVersion)b.request.api_version=this._options.apiVersion;if(!b.request.headers["User-Agent"])b.request.headers["User-Agent"]=window.navigator.userAgent;this._options.maskContent&&(b=this._options.maskContent(b));if(this._options.getMetadata)if(b.metadata){var d=
this._options.getMetadata(b);b.metadata=Object.assign(b.metadata,d)}else b.metadata=this._options.getMetadata(b);!this._options.skip(a)&&!xa(a)?(j.log("sending or queuing: "+a.request.uri),this._sendOrBatch(b,this._options.applicationId,I+this._options.host+ma,this.requestBatchers.events,this._options.callback)):j.log("skipped logging for "+a.request.uri)}},_getUserId:function(){return this._userId},_getCompanyId:function(){return this._companyId},_getSession:function(){return this._session},stop:function(){if(this._stopRecording)this._stopRecording(),
this._stopRecording=null;if(this._stopWeb3Recording)this._stopWeb3Recording(),this._stopWeb3Recording=null;if(this._stopFetchRecording)this._stopFetchRecording(),this._stopFetchRecording=null},clearCookies:function(){ta(this._options)},clearStorage:function(){ua(this._options)},resetAnonymousId:function(){return this._anonymousId=Z(this._persist)},reset:function(){ta(this._options);ua(this._options);this._anonymousId=Z(this._persist);this._campaign=this._session=this._userId=this._companyId=null}}}
var G={DEBUG:!1,LIB_VERSION:"1.8.11"},C;if("undefined"===typeof window){var B={hostname:""};C={navigator:{userAgent:""},document:{location:B,referrer:""},screen:{width:0,height:0},location:B}}else C=window;var B=Array.prototype,w=Object.prototype,J=B.slice,R=w.toString,T=w.hasOwnProperty,s=C.console,K=C.navigator,x=C.document,S=C.opera,U=C.screen,m=K.userAgent,aa=Function.prototype.bind,Ca=B.forEach,Da=B.indexOf,Ea=B.map,B=Array.isArray,ba={},c={trim:function(a){return a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,
"")}},j={log:function(){if(G.DEBUG&&!c.isUndefined(s)&&s)try{s.log.apply(s,arguments)}catch(a){c.each(arguments,function(a){s.log(a)})}},error:function(){if(G.DEBUG&&!c.isUndefined(s)&&s){var a=["Moesif error:"].concat(c.toArray(arguments));try{s.error.apply(s,a)}catch(b){c.each(a,function(a){s.error(a)})}}},critical:function(){if(!c.isUndefined(s)&&s){var a=["Moesif error:"].concat(c.toArray(arguments));try{s.error.apply(s,a)}catch(b){c.each(a,function(a){s.error(a)})}}}},ca=function(a,b){return function(){arguments[0]=
"["+b+"] "+arguments[0];return a.apply(j,arguments)}},w=function(a){return{log:ca(j.log,a),error:ca(j.error,a),critical:ca(j.critical,a)}};c.bind=function(a,b){var d,f;if(aa&&a.bind===aa)return aa.apply(a,J.call(arguments,1));if(!c.isFunction(a))throw new TypeError;d=J.call(arguments,2);return f=function(){if(!(this instanceof f))return a.apply(b,d.concat(J.call(arguments)));var c={};c.prototype=a.prototype;var e=new c;c.prototype=null;c=a.apply(e,d.concat(J.call(arguments)));return Object(c)===c?
c:e}};c.bind_instance_methods=function(a){for(var b in a)"function"===typeof a[b]&&(a[b]=c.bind(a[b],a))};c.each=function(a,b,d){if(!(null===a||void 0===a))if(Ca&&a.forEach===Ca)a.forEach(b,d);else if(a.length===+a.length)for(var c=0,h=a.length;c<h&&!(c in a&&b.call(d,a[c],c,a)===ba);c++);else for(c in a)if(T.call(a,c)&&b.call(d,a[c],c,a)===ba)break};c.escapeHTML=function(a){a&&c.isString(a)&&(a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,
"&#039;"));return a};c.extend=function(a){c.each(J.call(arguments,1),function(b){for(var d in b)void 0!==b[d]&&(a[d]=b[d])});return a};c.isArray=B||function(a){return"[object Array]"===R.call(a)};c.isFunction=function(a){try{return/^\s*\bfunction\b/.test(a)}catch(b){return!1}};c.isArguments=function(a){return!(!a||!T.call(a,"callee"))};c.toArray=function(a){return!a?[]:a.toArray?a.toArray():c.isArray(a)||c.isArguments(a)?J.call(a):c.values(a)};c.map=function(a,b){if(Ea&&a.map===Ea)return a.map(b);
var d=[];c.each(a,function(a){d.push(b(a))});return d};c.keys=function(a){var b=[];if(null===a)return b;c.each(a,function(a,c){b[b.length]=c});return b};c.values=function(a){var b=[];if(null===a)return b;c.each(a,function(a){b[b.length]=a});return b};c.identity=function(a){return a};c.include=function(a,b){var d=!1;if(null===a)return d;if(Da&&a.indexOf===Da)return-1!=a.indexOf(b);c.each(a,function(a){if(d||(d=a===b))return ba});return d};c.includes=function(a,b){return-1!==a.indexOf(b)};c.inherit=
function(a,b){a.prototype=new b;a.prototype.constructor=a;a.superclass=b.prototype;return a};c.isArrayBuffer=function(a){var b=Object.prototype.toString;return"function"===typeof ArrayBuffer&&(a instanceof ArrayBuffer||"[object ArrayBuffer]"===b.call(a))};c.isObject=function(a){return a===Object(a)&&!c.isArray(a)};c.isEmptyObject=function(a){if(c.isObject(a)){for(var b in a)if(T.call(a,b))return!1;return!0}return!1};c.isEmptyString=function(a){return!a||0===a.length};c.isUndefined=function(a){return void 0===
a};c.isString=function(a){return"[object String]"==R.call(a)};c.isDate=function(a){return"[object Date]"==R.call(a)};c.isNumber=function(a){return"[object Number]"==R.call(a)};c.isElement=function(a){return!!(a&&1===a.nodeType)};c.isNil=function(a){return c.isUndefined(a)||null===a};c.encodeDates=function(a){c.each(a,function(b,d){c.isDate(b)?a[d]=c.formatDate(b):c.isObject(b)&&(a[d]=c.encodeDates(b))});return a};c.timestamp=function(){Date.now=Date.now||function(){return+new Date};return Date.now()};
c.formatDate=function(a){function b(a){return 10>a?"0"+a:a}return a.getUTCFullYear()+"-"+b(a.getUTCMonth()+1)+"-"+b(a.getUTCDate())+"T"+b(a.getUTCHours())+":"+b(a.getUTCMinutes())+":"+b(a.getUTCSeconds())};c.safewrap=function(a){return function(){try{return a.apply(this,arguments)}catch(b){j.critical("Implementation error. Please turn on debug and contact support@Moesif.com."),G.DEBUG&&j.critical(b)}}};c.safewrap_class=function(a,b){for(var d=0;d<b.length;d++)a.prototype[b[d]]=c.safewrap(a.prototype[b[d]])};
c.safewrap_instance_methods=function(a){for(var b in a)"function"===typeof a[b]&&(a[b]=c.safewrap(a[b]))};c.strip_empty_properties=function(a){var b={};c.each(a,function(a,f){c.isString(a)&&0<a.length&&(b[f]=a)});return b};c.truncate=function(a,b){var d;"string"===typeof a?d=a.slice(0,b):c.isArray(a)?(d=[],c.each(a,function(a){d.push(c.truncate(a,b))})):c.isObject(a)?(d={},c.each(a,function(a,h){d[h]=c.truncate(a,b)})):d=a;return d};c.JSONEncode=function(){return function(a){var b=function(a){var b=
/[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,c={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};b.lastIndex=0;return b.test(a)?'"'+a.replace(b,function(a){var b=c[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'},c=function(a,h){var e="",i=0,k=i="",k=0,g=e,l=[],n=h[a];n&&"object"===typeof n&&"function"===typeof n.toJSON&&(n=n.toJSON(a));
switch(typeof n){case "string":return b(n);case "number":return isFinite(n)?""+n:"null";case "boolean":case "null":return""+n;case "object":if(!n)return"null";e+="    ";l=[];if("[object Array]"===R.apply(n)){k=n.length;for(i=0;i<k;i+=1)l[i]=c(i,n)||"null";return k=0===l.length?"[]":e?"[\n"+e+l.join(",\n"+e)+"\n"+g+"]":"["+l.join(",")+"]"}for(i in n)T.call(n,i)&&(k=c(i,n))&&l.push(b(i)+(e?": ":":")+k);return k=0===l.length?"{}":e?"{"+l.join(",")+""+g+"}":"{"+l.join(",")+"}"}};return c("",{"":a})}}();
c.JSONDecode=function(){var a,b,c={'"':'"',"\\":"\\","/":"/",b:"\u0008",f:"\u000c",n:"\n",r:"\r",t:"\t"},f,h=function(b){b=new SyntaxError(b);b.at=a;b.text=f;throw b;},e=function(c){c&&c!==b&&h("Expected '"+c+"' instead of '"+b+"'");b=f.charAt(a);a+=1;return b},i=function(){var a;a="";"-"===b&&(a="-",e("-"));for(;"0"<=b&&"9">=b;)a+=b,e();if("."===b)for(a+=".";e()&&"0"<=b&&"9">=b;)a+=b;if("e"===b||"E"===b){a+=b;e();if("-"===b||"+"===b)a+=b,e();for(;"0"<=b&&"9">=b;)a+=b,e()}a=+a;if(isFinite(a))return a;
h("Bad number")},k=function(){var a,f,g="",i;if('"'===b)for(;e();){if('"'===b)return e(),g;if("\\"===b)if(e(),"u"===b){for(f=i=0;4>f;f+=1){a=parseInt(e(),16);if(!isFinite(a))break;i=16*i+a}g+=String.fromCharCode(i)}else if("string"===typeof c[b])g+=c[b];else break;else g+=b}h("Bad string")},g=function(){for(;b&&" ">=b;)e()},l=function(){switch(b){case "t":return e("t"),e("r"),e("u"),e("e"),!0;case "f":return e("f"),e("a"),e("l"),e("s"),e("e"),!1;case "n":return e("n"),e("u"),e("l"),e("l"),null}h('Unexpected "'+
b+'"')},n;n=function(){g();switch(b){case "{":var a;a:{var c,d={};if("{"===b){e("{");g();if("}"===b){e("}");a=d;break a}for(;b;){c=k();g();e(":");Object.hasOwnProperty.call(d,c)&&h('Duplicate key "'+c+'"');d[c]=n();g();if("}"===b){e("}");a=d;break a}e(",");g()}}h("Bad object")}return a;case "[":a:{a=[];if("["===b){e("[");g();if("]"===b){e("]");c=a;break a}for(;b;){a.push(n());g();if("]"===b){e("]");c=a;break a}e(",");g()}}h("Bad array")}return c;case '"':return k();case "-":return i();default:return"0"<=
b&&"9">=b?i():l()}};return function(c){f=c;a=0;b=" ";c=n();g();b&&h("Syntax error");return c}}();c.base64Encode=function(a){var b,d,f,h,e=0,i=0,k="",k=[];if(!a)return a;a=c.utf8Encode(a);do b=a.charCodeAt(e++),d=a.charCodeAt(e++),f=a.charCodeAt(e++),h=b<<16|d<<8|f,b=h>>18&63,d=h>>12&63,f=h>>6&63,h&=63,k[i++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h);while(e<a.length);k=k.join("");switch(a.length%3){case 1:k=k.slice(0,-2)+"==";break;case 2:k=k.slice(0,-1)+"="}return k};c.utf8Encode=function(a){var a=(a+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n"),b="",c,f,h=0,e;c=f=0;h=a.length;for(e=0;e<h;e++){var i=a.charCodeAt(e),k=null;128>i?f++:k=127<i&&2048>i?String.fromCharCode(i>>6|192,i&63|128):String.fromCharCode(i>>12|224,i>>6&63|128,i&63|128);null!==k&&(f>c&&(b+=a.substring(c,
f)),b+=k,c=f=e+1)}f>c&&(b+=a.substring(c,a.length));return b};c.UUID=function(){var a=function(){function a(b,c){var d,e=0;for(d=0;d<c.length;d++)e|=h[d]<<8*d;return b^e}var c,f,h=[],e=0;for(c=0;c<m.length;c++)f=m.charCodeAt(c),h.unshift(f&255),4<=h.length&&(e=a(e,h),h=[]);0<h.length&&(e=a(e,h));return e.toString(16)};return function(){for(var b=(U.height*U.width).toString(16),c=1*new Date,f=0;c==1*new Date;)f++;return c.toString(16)+f.toString(16)+"-"+Math.random().toString(16).replace(".","")+"-"+
a()+"-"+b}}();c.isBlockedUA=function(a){return/(google web preview|baiduspider|yandexbot|bingbot|googlebot|yahoo! slurp)/i.test(a)?!0:!1};c.HTTPBuildQuery=function(a,b){var d,f,h=[];c.isUndefined(b)&&(b="&");c.each(a,function(a,b){d=encodeURIComponent(a.toString());f=encodeURIComponent(b);h[h.length]=f+"="+d});return h.join(b)};c.getUrlParams=function(){var a;if(a=location)if(!(a=location.search))a:{if(a=location.href){var b=a.indexOf("?");if(0<=b){a=a.substring(b);break a}}a=""}return a};c.getQueryParamByName=
function(a,b){var a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),c=RegExp("[\\?&]"+a+"=([^&#]*)").exec(b);return null===c?void 0:decodeURIComponent(c[1].replace(/\+/g," "))};c.getQueryParam=function(a,b){var b=b.replace(/[[]/,"\\[").replace(/[\]]/,"\\]"),c=RegExp("[\\?&]"+b+"=([^&#]*)").exec(a);if(null===c||c&&"string"!==typeof c[1]&&c[1].length)return"";c=c[1];try{c=decodeURIComponent(c)}catch(f){j.error("Skipping decoding for malformed query param: "+c)}return c.replace(/\+/g," ")};c.getHashParam=
function(a,b){var c=a.match(RegExp(b+"=([^&]*)"));return c?c[1]:null};c.cookie={get:function(a){for(var a=a+"=",b=x.cookie.split(";"),c=0;c<b.length;c++){for(var f=b[c];" "==f.charAt(0);)f=f.substring(1,f.length);if(0===f.indexOf(a))return decodeURIComponent(f.substring(a.length,f.length))}return null},parse:function(a){var b;try{b=c.JSONDecode(c.cookie.get(a))||{}}catch(d){}return b},set_seconds:function(a,b,c,f,h,e,i){var k="",g="",l="";i?k="; domain="+i:f&&(k=(k=Fa(x.location.hostname))?"; domain=."+
k:"");c&&(g=new Date,g.setTime(g.getTime()+1E3*c),g="; expires="+g.toGMTString());e&&(h=!0,l="; SameSite=None");h&&(l+="; secure");x.cookie=a+"="+encodeURIComponent(b)+g+"; path=/"+k+l},set:function(a,b,c,f,h,e,i){var k="",g="",l="";i?k="; domain="+i:f&&(k=(k=Fa(x.location.hostname))?"; domain=."+k:"");c&&(g=new Date,g.setTime(g.getTime()+864E5*c),g="; expires="+g.toGMTString());e&&(h=!0,l="; SameSite=None");h&&(l+="; secure");a=a+"="+encodeURIComponent(b)+g+"; path=/"+k+l;return x.cookie=a},remove:function(a,
b,d){c.cookie.set(a,"",-1,b,!1,!1,d)}};var da=null,Q=function(a,b){if(null!==da&&!b)return da;var c=!0;try{var a=a||window.localStorage,f="__mplss_"+ea(8);a.setItem(f,"xyz");"xyz"!==a.getItem(f)&&(c=!1);a.removeItem(f)}catch(h){c=!1}return da=c};c.localStorage={is_supported:function(a){(a=Q(null,a))||j.error("localStorage unsupported; falling back to cookie store");return a},error:function(a){j.error("localStorage error: "+a)},get:function(a){try{return window.localStorage.getItem(a)}catch(b){c.localStorage.error(b)}return null},
parse:function(a){try{return c.JSONDecode(c.localStorage.get(a))||{}}catch(b){}return null},set:function(a,b){try{window.localStorage.setItem(a,b)}catch(d){c.localStorage.error(d)}},remove:function(a){try{window.localStorage.removeItem(a)}catch(b){c.localStorage.error(b)}}};c.register_event=function(){function a(a,f,h){return function(e){if(e=e||b(window.event)){var i=!0,k;c.isFunction(h)&&(k=h(e));e=f.call(a,e);if(!1===k||!1===e)i=!1;return i}}}function b(a){if(a)a.preventDefault=b.preventDefault,
a.stopPropagation=b.stopPropagation;return a}b.preventDefault=function(){this.returnValue=!1};b.stopPropagation=function(){this.cancelBubble=!0};return function(b,c,h,e,i){b?b.addEventListener&&!e?b.addEventListener(c,h,!!i):(c="on"+c,b[c]=a(b,h,b[c])):j.error("No valid element provided to register_event")}}();var Ta=/^(\w*)\[(\w+)([=~\|\^\$\*]?)=?"?([^\]"]*)"?\]$/;c.dom_query=function(){function a(a,b){var c;return 0<=(" "+a.className+" ").replace(d," ").indexOf(" "+b+" ")}function b(b){if(!x.getElementsByTagName)return[];
var b=b.split(" "),d,e,i,k,g,l,n,j=[x];for(k=0;k<b.length;k++)if(d=b[k].replace(/^\s+/,"").replace(/\s+$/,""),-1<d.indexOf("#")){e=d.split("#");d=e[0];j=x.getElementById(e[1]);if(!j||d&&j.nodeName.toLowerCase()!=d)return[];j=[j]}else if(-1<d.indexOf(".")){e=d.split(".");d=e[0];var m=e[1];d||(d="*");e=[];for(g=i=0;g<j.length;g++){n="*"==d?j[g].all?j[g].all:j[g].getElementsByTagName("*"):j[g].getElementsByTagName(d);for(l=0;l<n.length;l++)e[i++]=n[l]}j=[];for(g=d=0;g<e.length;g++)e[g].className&&c.isString(e[g].className)&&
a(e[g],m)&&(j[d++]=e[g])}else if(e=d.match(Ta)){d=e[1];var o=e[2],m=e[3],p=e[4];d||(d="*");e=[];for(g=i=0;g<j.length;g++){n="*"==d?j[g].all?j[g].all:j[g].getElementsByTagName("*"):j[g].getElementsByTagName(d);for(l=0;l<n.length;l++)e[i++]=n[l]}j=[];d=0;switch(m){case "=":m=function(a){return a.getAttribute(o)==p};break;case "~":m=function(a){return a.getAttribute(o).match(RegExp("\\b"+p+"\\b"))};break;case "|":m=function(a){return a.getAttribute(o).match(RegExp("^"+p+"-?"))};break;case "^":m=function(a){return 0===
a.getAttribute(o).indexOf(p)};break;case "$":m=function(a){return a.getAttribute(o).lastIndexOf(p)==a.getAttribute(o).length-p.length};break;case "*":m=function(a){return-1<a.getAttribute(o).indexOf(p)};break;default:m=function(a){return a.getAttribute(o)}}j=[];for(g=d=0;g<e.length;g++)m(e[g])&&(j[d++]=e[g])}else{e=[];for(g=i=0;g<j.length;g++){n=j[g].getElementsByTagName(d);for(l=0;l<n.length;l++)e[i++]=n[l]}j=e}return j}var d=/[\t\r\n]/g;return function(a){return c.isElement(a)?[a]:c.isObject(a)&&
!c.isUndefined(a.length)?a:b.call(this,a)}}();c.info={campaignParams:function(){var a="utm_source utm_medium utm_campaign utm_content utm_term".split(" "),b="",d={};c.each(a,function(a){b=c.getQueryParam(x.URL,a);b.length&&(d[a]=b)});return d},searchEngine:function(a){return 0===a.search("https?://(.*)google.([^/?]*)")?"google":0===a.search("https?://(.*)bing.com")?"bing":0===a.search("https?://(.*)yahoo.com")?"yahoo":0===a.search("https?://(.*)duckduckgo.com")?"duckduckgo":null},searchInfo:function(a){var b=
c.info.searchEngine(a),d;d={};if(null!==b)d.$search_engine=b,a=c.getQueryParam(a,"yahoo"!=b?"q":"p"),a.length&&(d.mp_keyword=a);return d},browser:function(a,b,d){b=b||"";return d||c.includes(a," OPR/")?c.includes(a,"Mini")?"Opera Mini":"Opera":/(BlackBerry|PlayBook|BB10)/i.test(a)?"BlackBerry":c.includes(a,"IEMobile")||c.includes(a,"WPDesktop")?"Internet Explorer Mobile":c.includes(a,"SamsungBrowser/")?"Samsung Internet":c.includes(a,"Edge")||c.includes(a,"Edg/")?"Microsoft Edge":c.includes(a,"FBIOS")?
"Facebook Mobile":c.includes(a,"Chrome")?"Chrome":c.includes(a,"CriOS")?"Chrome iOS":c.includes(a,"UCWEB")||c.includes(a,"UCBrowser")?"UC Browser":c.includes(a,"FxiOS")?"Firefox iOS":c.includes(b,"Apple")?c.includes(a,"Mobile")?"Mobile Safari":"Safari":c.includes(a,"Android")?"Android Mobile":c.includes(a,"Konqueror")?"Konqueror":c.includes(a,"Firefox")?"Firefox":c.includes(a,"MSIE")||c.includes(a,"Trident/")?"Internet Explorer":c.includes(a,"Gecko")?"Mozilla":""},browserVersion:function(a,b,d){b=
{"Internet Explorer Mobile":/rv:(\d+(\.\d+)?)/,"Microsoft Edge":/Edge?\/(\d+(\.\d+)?)/,Chrome:/Chrome\/(\d+(\.\d+)?)/,"Chrome iOS":/CriOS\/(\d+(\.\d+)?)/,"UC Browser":/(UCBrowser|UCWEB)\/(\d+(\.\d+)?)/,Safari:/Version\/(\d+(\.\d+)?)/,"Mobile Safari":/Version\/(\d+(\.\d+)?)/,Opera:/(Opera|OPR)\/(\d+(\.\d+)?)/,Firefox:/Firefox\/(\d+(\.\d+)?)/,"Firefox iOS":/FxiOS\/(\d+(\.\d+)?)/,Konqueror:/Konqueror:(\d+(\.\d+)?)/,BlackBerry:/BlackBerry (\d+(\.\d+)?)/,"Android Mobile":/android\s(\d+(\.\d+)?)/,"Samsung Internet":/SamsungBrowser\/(\d+(\.\d+)?)/,
"Internet Explorer":/(rv:|MSIE )(\d+(\.\d+)?)/,Mozilla:/rv:(\d+(\.\d+)?)/}[c.info.browser(a,b,d)];if(void 0===b)return null;a=a.match(b);return!a?null:parseFloat(a[a.length-2])},os:function(){return/Windows/i.test(m)?/Phone/.test(m)||/WPDesktop/.test(m)?"Windows Phone":"Windows":/(iPhone|iPad|iPod)/.test(m)?"iOS":/Android/.test(m)?"Android":/(BlackBerry|PlayBook|BB10)/i.test(m)?"BlackBerry":/Mac/i.test(m)?"Mac OS X":/Linux/.test(m)?"Linux":/CrOS/.test(m)?"Chrome OS":""},device:function(a){return/Windows Phone/i.test(a)||
/WPDesktop/.test(a)?"Windows Phone":/iPad/.test(a)?"iPad":/iPod/.test(a)?"iPod Touch":/iPhone/.test(a)?"iPhone":/(BlackBerry|PlayBook|BB10)/i.test(a)?"BlackBerry":/Android/.test(a)?"Android":""},referringDomain:function(a){a=a.split("/");return 3<=a.length?a[2]:""},properties:function(){return c.extend(c.strip_empty_properties({$os:c.info.os(),$browser:c.info.browser(m,K.vendor,S),$referrer:x.referrer,$referring_domain:c.info.referringDomain(x.referrer),$device:c.info.device(m)}),{$current_url:C.location.href,
$browser_version:c.info.browserVersion(m,K.vendor,S),$screen_height:U.height,$screen_width:U.width,mp_lib:"web",$lib_version:G.LIB_VERSION,$insert_id:ea(),time:c.timestamp()/1E3})},people_properties:function(){return c.extend(c.strip_empty_properties({$os:c.info.os(),$browser:c.info.browser(m,K.vendor,S)}),{$browser_version:c.info.browserVersion(m,K.vendor,S)})},pageviewInfo:function(a){return c.strip_empty_properties({mp_page:a,mp_referrer:x.referrer,mp_browser:c.info.browser(m,K.vendor,S),mp_platform:c.info.os()})}};
var ea=function(a){var b=Math.random().toString(36).substring(2,10)+Math.random().toString(36).substring(2,10);return a?b.substring(0,a):b},Ba=function(a){var b=5381;if(0==a.length)return b;for(var c=0;c<a.length;c++)b=(b<<5)-b+a.charCodeAt(c),b&=b;return b};c.safewrap(function(a,b,c){return(Ba(a+b)>>>0)%100<c});var Ua=/[a-z0-9][a-z0-9-]*\.[a-z]+$/i,Va=/[a-z0-9][a-z0-9-]+\.[a-z.]{2,6}$/i,Fa=function(a){var b=Va,c=a.split("."),c=c[c.length-1];if(4<c.length||"com"===c||"org"===c)b=Ua;return(a=a.match(b))?
a[0]:""},E=null,V=null;if("undefined"!==typeof JSON)E=JSON.stringify,V=JSON.parse;E=E||c.JSONEncode;V=V||c.JSONDecode;c.toArray=c.toArray;c.isObject=c.isObject;c.JSONEncode=c.JSONEncode;c.JSONDecode=c.JSONDecode;c.isBlockedUA=c.isBlockedUA;c.isEmptyObject=c.isEmptyObject;c.isEmptyString=c.isEmptyString;c.info=c.info;c.info.device=c.info.device;c.info.browser=c.info.browser;c.info.browserVersion=c.info.browserVersion;c.info.properties=c.info.properties;var D=w("parsers"),X=function(a){try{return{body:c.JSONDecode(a)}}catch(b){return D.log("JSON decode failed"),
D.log(b),{transfer_encoding:"base64",body:c.base64Encode(a)}}},oa=function(a){if(!a)return{};D.log("about to decode buffer");D.log(a);D.log(a.byteLength);if(0>=a.byteLength)return{};try{var b=(new TextDecoder("utf-8")).decode(a);try{return{body:c.JSONDecode(b)}}catch(d){return D.error(d),{transfer_encoding:"base64",body:c.base64Encode(b)}}}catch(f){return D.error(f),D.log(a),{transfer_encoding:"base64",body:"can not be decoded"}}},p=w("capture"),Ha="http:"===(document&&document.location.protocol)?
"http://":"https://",u=w("web3capture"),r=w("capture fetch"),va=w("referrer"),sa=w("utm"),q={UTM_SOURCE:"utm_source",UTM_MEDIUM:"utm_medium",UTM_CAMPAIGN:"utm_campaign",UTM_TERM:"utm_term",UTM_CONTENT:"utm_content"};L="moesif_stored_user_id";M="moesif_stored_company_id";O="moesif_stored_session_id";N="moesif_anonymous_id";P="moesif_campaign_data";W="moesif_initial_campaign";var y=w("campaign"),Wa=w("lock"),Ga=function(a,b){b=b||{};this.storageKey=a;this.storage=b.storage||window.localStorage;this.pollIntervalMS=
b.pollIntervalMS||100;this.timeoutMS=b.timeoutMS||2E3};Ga.prototype.withLock=function(a,b,c){!c&&"function"!==typeof b&&(c=b,b=null);var f=c||(new Date).getTime()+"|"+Math.random(),h=(new Date).getTime(),e=this.storageKey,i=this.pollIntervalMS,k=this.timeoutMS,g=this.storage,l=e+":X",j=e+":Y",m=e+":Z",o=function(a){(new Date).getTime()-h>k?(Wa.error("Timeout waiting for mutex on "+e+"; clearing lock. ["+f+"]"),g.removeItem(m),g.removeItem(j),q()):setTimeout(function(){try{a()}catch(c){b&&b(c)}},i*
(Math.random()+0.1))},p=function(a,b){a()?b():o(function(){p(a,b)})},r=function(){var a=g.getItem(j);if(a&&a!==f)return!1;g.setItem(j,f);if(g.getItem(j)===f)return!0;if(!Q(g,!0))throw Error("localStorage support dropped while acquiring lock");return!1},q=function(){g.setItem(l,f);p(r,function(){g.getItem(l)===f?t():o(function(){g.getItem(j)!==f?q():p(function(){return!g.getItem(m)},t)})})},t=function(){g.setItem(m,"1");try{a()}finally{g.removeItem(m),g.getItem(j)===f&&g.removeItem(j),g.getItem(l)===
f&&g.removeItem(l)}};try{if(Q(g,!0))q();else throw Error("localStorage support check failed");}catch(s){b&&b(s)}};var o=w("batch"),F=function(a,b){b=b||{};this.storageKey=a;this.storage=b.storage||window.localStorage;this.lock=new Ga(a,{storage:this.storage});this.storageExpiration=b.storageExpiration||216E5;this.pid=b.pid||null;this.memQueue=[]};F.prototype.enqueue=function(a,b,d){var f={id:ea(),flushAfter:(new Date).getTime()+2*b,payload:a};this.lock.withLock(c.bind(function(){var b;try{var c=this.readFromStorage();
c.push(f);if(b=this.saveToStorage(c))o.log("succeeded saving to storage"),this.memQueue.push(f)}catch(i){o.error("Error enqueueing item",a),b=!1}d&&d(b)},this),function(a){o.error("Error acquiring storage lock",a);d&&d(!1)},this.pid)};F.prototype.fillBatch=function(a){this.memQueue=fa(this.memQueue,{},this.storageExpiration);var b=this.memQueue.slice(0,a);if(b.length<a){var d=this.readFromStorage();o.log("current storedQueue size "+d.length);if(d.length){var f={};c.each(b,function(a){f[a.id]=!0});
for(var h=0;h<d.length;h++){var e=d[h],i=(new Date).getTime(),j=i-this.storageExpiration;if(i>e.flushAfter&&e.flushAfter>=j&&!f[e.id]){if(b.push(e),b.length>=a)break}else o.log("fill batch filtered item because invalid or expired"+E(e))}}}return b};var fa=function(a,b,d){var f=[],h=(new Date).getTime()-d;o.log("expiration time is "+h);c.each(a,function(a){a.id&&!b[a.id]?a.flushAfter&&a.flushAfter>=h&&f.push(a):o.log("filtered out item because invalid or expired"+E(a))});return f};F.prototype.removeItemsByID=
function(a,b){var d={};c.each(a,function(a){d[a]=!0});this.memQueue=fa(this.memQueue,d,this.storageExpiration);var f=c.bind(function(){var b;try{var c=this.readFromStorage(),c=fa(c,d,this.storageExpiration);b=this.saveToStorage(c)}catch(f){o.error("Error removing items",a),b=!1}return b},this);this.lock.withLock(c.bind(function(){var a=f();b&&(o.log("triggering callback of removalItems"),b(a))},this),c.bind(function(a){var c=!1;o.error("Error acquiring storage lock",a);if(!Q(this.storage,!0)&&(c=
f(),!c)){o.error("still can not remove from storage, thus stop using storage");try{this.storage.removeItem(this.storageKey)}catch(d){o.error("error clearing queue",d)}}b&&b(c)},this),this.pid)};F.prototype.readFromStorage=function(){var a;try{o.log("trying to get storage with storage key "+this.storageKey),(a=this.storage.getItem(this.storageKey))?(a=V(a),c.isArray(a)||(o.error("Invalid storage entry:",a),a=null)):o.log("storageEntry is empty")}catch(b){o.error("Error retrieving queue",b),a=null}return a||
[]};F.prototype.saveToStorage=function(a){try{return this.storage.setItem(this.storageKey,E(a)),!0}catch(b){return o.error("Error saving queue",b),!1}};F.prototype.clear=function(){this.memQueue=[];try{this.storage.removeItem(this.storageKey)}catch(a){o.error("Failed to clear storage",a)}};var z=w("batch"),A=function(a,b,c){this.queue=new F(a,{storage:c.storage,storageExpiration:c.libConfig.batch_storage_expiration});this.endpoint=b;this.libConfig=c.libConfig;this.sendRequest=c.sendRequestFunc;this.batchSize=
this.libConfig.batch_size;this.flushInterval=this.libConfig.batch_flush_interval_ms;this.stopAllBatching=c.stopAllBatching;this.stopped=!1;this.removalFailures=0};A.prototype.enqueue=function(a,b){this.queue.enqueue(a,this.flushInterval,b)};A.prototype.start=function(){this.stopped=!1;this.removalFailures=0;this.flush()};A.prototype.stop=function(){this.stopped=!0;if(this.timeoutID)clearTimeout(this.timeoutID),this.timeoutID=null};A.prototype.clear=function(){this.queue.clear()};A.prototype.resetBatchSize=
function(){this.batchSize=this.libConfig.batch_size};A.prototype.resetFlush=function(){this.scheduleFlush(this.libConfig.batch_flush_interval_ms)};A.prototype.scheduleFlush=function(a){this.flushInterval=a;if(!this.stopped)this.timeoutID=setTimeout(c.bind(this.flush,this),this.flushInterval)};A.prototype.flush=function(a){try{if(this.requestInProgress)z.log("Flush: Request already in progress");else{var a=a||{},b=this.batchSize,d=this.queue.fillBatch(b);z.log("current batch size is "+d.length);if(1>
d.length)this.resetFlush();else{this.requestInProgress=!0;var f=this.libConfig.batch_request_timeout_ms,h=(new Date).getTime(),e=c.map(d,function(a){return a.payload}),i=c.bind(function(a){this.requestInProgress=!1;try{var e=!1;if(c.isObject(a)&&"timeout"===a.error&&(new Date).getTime()-h>=f)z.error("Network timeout; retrying"),this.flush();else if(c.isObject(a)&&a.xhr_req&&(500<=a.xhr_req.status||0>=a.xhr_req.status)){var g=2*this.flushInterval,i=a.xhr_req.responseHeaders;if(i){var j=i["Retry-After"];
j&&(g=1E3*parseInt(j,10)||g)}g=Math.min(6E5,g);z.error("Error; retry in "+g+" ms");this.scheduleFlush(g)}else if(c.isObject(a)&&a.xhr_req&&413===a.xhr_req.status)if(1<d.length){var k=Math.max(1,Math.floor(b/2));this.batchSize=Math.min(this.batchSize,k,d.length-1);z.error("413 response; reducing batch size to "+this.batchSize);this.resetFlush()}else z.error("Single-event request too large; dropping",d),this.resetBatchSize(),e=!0;else e=!0;e&&this.queue.removeItemsByID(c.map(d,function(a){return a.id}),
c.bind(function(a){a?(this.removalFailures=0,this.flush()):(this.removalFailures+=1,z.error("failed to remove items from batched queue "+this.removalFailures+" times."),5<this.removalFailures?(z.error("stop batching because too m any errors remove from storage"),this.stopAllBatching()):this.resetFlush())},this))}catch(m){z.error("Error handling API response",m),this.resetFlush()}},this),j={method:"POST",verbose:!0,ignore_json_errors:!0,timeout_ms:f};if(a.sendBeacon)j.transport="sendBeacon";z.log("Moesif Request:",
this.endpoint,e);this.sendRequest(this.endpoint,e,j,i)}}}catch(g){z.error("Error flushing request queue",g),this.resetFlush()}};ga="api.moesif.net";ma="/v1/events";ha="/v1/events/batch";la="/v1/actions";ia="/v1/actions/batch";ja="/v1/users";ka="/v1/companies";var za=window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest;!za&&-1===m.indexOf("MSIE")&&m.indexOf("Mozilla");var $=function(){},Aa=null;navigator.sendBeacon&&(Aa=function(){return navigator.sendBeacon.apply(navigator,arguments)});var I=
"http:"===(document&&document.location.protocol)?"http://":"https://";window.moesif=ya();window.moesif["new"]=ya})();
})();
